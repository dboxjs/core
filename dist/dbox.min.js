!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3"),require("lodash")):"function"==typeof define&&define.amd?define(["exports","d3","lodash"],e):e(t.dbox={},t.d3,t._)}(this,function(t,e,n){"use strict";function i(){var t=this,n={chart:{config:t._config,width:t._width,height:t._height,style:t._addStyle,fullSvg:function(){return t._fullSvg},svg:function(){return t._svg}},utils:{d3:{}}};return n.utils.d3.tip="function"==typeof h?h:h.default,n.utils.generateScale=function(t,n){var i,o={};if(!n.range)throw"Range is not defined";if(i=n.groupBy&&"parent"===n.groupBy?t.map(function(t){return t[n.column]}):n.stackBy&&"parent"===n.stackBy?t[0].map(function(t){return t.data[n.column]}):"children"===n.groupBy?n.column:"data"===n.groupBy?[0,e.max(t,function(t){return e.max(n.column,function(e){return t[e]})})]:"data"===n.stackBy?[0,e.max(t,function(t){return e.max(t,function(t){return t[1]})})]:void 0===n.groupBy&&"band"===n.type?t.map(function(t){return t[n.column]}):"linear"===n.type?n.minZero?[0,e.max(t,function(t){return+t[n.column]})]:e.extent(t,function(t){return+t[n.column]}):t.map(function(t){return t[n.column]}),n.domains&&Array.isArray(n.domains)&&(i=n.domains),n.type)switch(n.type){case"linear":o=e.scaleLinear().rangeRound(n.range).domain(i).nice();break;case"time":o=e.scaleTime().range(n.range);break;case"ordinal":o=e.scaleBand().rangeRound(n.range).padding(.1).domain(i);break;case"band":o=e.scaleBand().rangeRound(n.range).domain(i).padding(.1);break;case"quantile":o=e.scaleBand().rangeRound(n.range).padding(.1).domain(t.map(function(t){return t[n.column]})),n.bins||(n.bins=10),o=e.scaleQuantile().range(e.range(n.bins));break;default:o=e.scaleLinear().rangeRound(n.range).domain(i).nice()}else o=e.scaleLinear().rangeRound(n.range).domain(i).nice();return o},n.utils.format=function(n,i){if(!n){var o=t._config.yAxis&&"linear"===t._config.yAxis.scale?"yAxis":t._config.xAxis&&"linear"===t._config.xAxis.scale?"xAxis":"";n={decimals:t._config.decimals,axis:o,formatPreffix:t._config.formatPreffix,formatSuffix:t._config.formatSuffix}}return function(o){if(Number.isNaN(Number(o)))return o;var a=1;void 0!==n.decimals&&Number.isInteger(n.decimals)&&(a=Number(n.decimals));var r="";n.formatPreffix&&(r+=n.formatPreffix);var s="";if(i){var c=n.axis,l=c?e.mean(t._scales[c.replace("Axis","")].ticks()):o;l>=1e12?(c?t._config[c].scaleText="Billones":s=" billones",o/=1e12):l>=1e9?(c?t._config[c].scaleText="Miles de millones":s=" mil millones",o/=1e9):l>=1e6?(c?t._config[c].scaleText="Millones":s=" millones",o/=1e6):l>=1e4&&(c?t._config[c].scaleText="Miles":s=" mil",o/=1e3)}if(Number.isInteger(o))r+=e.format(",.0f")(o);else if(o>1)r+=e.format(",."+a+"f")(o);else{var f=o.toString().split(".")[1],u=1;if(f){for(var g=0;g<f.length;g++){var d=Number(f[g]);if(0!==d)break;u+=1}r+=e.format(",."+u+"f")(o)}}return r+=s,n.formatSuffix&&r.indexOf(n.formatSuffix)<0&&(r+=n.formatSuffix),r}},n.utils.wrap=function(t,n,i){t.each(function(){for(var t,o=e.select(this),a=o.text().split(/\s+/).reverse(),r=[],s=0,c=o.attr("y"),l=parseFloat(o.attr("dy"))||0,f=o.text(null).append("tspan").attr("x",0).attr("y",c).attr("dy",l+"em");t=a.pop();)r.push(t),f.text(r.join(" ")),f.node().getComputedTextLength()>n&&(r.pop(),f.text(r.join(" ")),r=[t],f=o.append("tspan").attr("x",0).attr("y",c).attr("dy",1.1*++s+l+"em").text(t),s>0?(a.length>0&&f.node().getComputedTextLength()>n&&function(){i&&o.on("mouseover",i.show).on("mouseout",i.hide);for(var t=1;f.node().getComputedTextLength()>n;)f.text(function(){return f.text().slice(0,-t)+"..."}),++t}(),a=[]):function(){for(var t=1;f.node().getComputedTextLength()>n;)f.text(function(){return f.text().slice(0,-t)+"..."}),++t}())})},n.utils.sortAscending=function(t,e){return Number.isNaN(+t)||Number.isNaN(+e)?!Number.isNaN(+t)&&Number.isNaN(+e)?-1:Number.isNaN(+t)&&!Number.isNaN(+e)?1:t<=e?-1:1:Number(t)-Number(e)},n.utils.sortDescending=function(t,e){return Number.isNaN(+e)||Number.isNaN(+t)?!Number.isNaN(+e)&&Number.isNaN(+t)?-1:Number.isNaN(+e)&&!Number.isNaN(+t)?1:e<=t?-1:1:Number(e)-Number(t)},n.utils.VirtualScroller=function(){function n(l){function _(t){t&&(p=parseInt(f.style("height"))-170,x=Math.ceil(p/d));var e=g;g<s.length&&g>=0&&v<0?g+=1:g<=s.length&&g>0&&v>0&&(g-=1),h=g-e,b(g)}function b(n){var i=Math.max(0,Math.min(n,u-x+1)),f=i+x;l.each(function(){var n=l.selectAll(".legend-checkbox").data(s.slice(i,Math.min(f,u)),c);n.exit().call(r).remove(),n.enter().append("g").attr("class","legend-checkbox legend").attr("random",function(t){return t}).call(o).attr("transform",function(e,n){return"translate(0,"+21*(t._config.legendTitle&&y>1?y*m+n:1+n)+")"}).on("click",function(n){var i=s.findIndex(function(t){return t.name===n.name});"function"==typeof t._config.events.onClickLegend&&t._config.events.onClickLegend.call(this,n,i),e.event.stopPropagation()}),n.order();var g=l.selectAll(".legend-checkbox");g.call(a),g.each(function(n,i){e.select(this).attr("font-weight","bold").attr("transform",function(e){return"translate(0,"+21*(t._config.legendTitle&&y>1?y*m+i:1+i)+")"})})})}n.render=_;var A="undefined"!=typeof InstallTrigger,w="onwheel"in e.select(".legendBox")?"wheel":void 0!==document.onmousewheel?"mousewheel":"wheel";e.select(".legendBox").on(w,function(){var t=e.event;t.preventDefault(),v=A?t.deltaY:t.wheelDelta,_(!0)}),_(!0),i(x)}function i(t){var n=e.select(".legendBox").append("g").attr("class","scroll-legend").append("text").attr("transform","translate(0,"+25*t+")");n.append("tspan").attr("class","material-icons expand-more").text("mouse"),n.append("tspan").attr("x",30).attr("y",-12).text("Despl√°zate con el"),n.append("tspan").attr("x",60).attr("y",-1).text("cursor"),u<t?e.selectAll(".scroll-legend").style("display","none"):e.selectAll(".scroll-legend").style("display","flex")}var o=null,a=null,r=null,s=[],c=null,l=null,f=null,u=0,g=0,d=30,_=0,p=0,x=0,h=0,y=0,m=.7,v=0;return n.render=function(t){},n.data=function(t,e){return arguments.length?(s=t,c=e,n):s},n.dataid=function(t){return arguments.length?(c=t,n):c},n.enter=function(t){return arguments.length?(o=t,n):o},n.update=function(t){return arguments.length?(a=t,n):a},n.exit=function(t){return arguments.length?(r=t,n):r},n.totalRows=function(t){return arguments.length?(u=t,n):u},n.rowHeight=function(t){return arguments.length?(d=+t,n):d},n.totalHeight=function(t){return arguments.length?(_=+t,n):_},n.position=function(t){return arguments.length?(g=+t,f&&(f.node().scrollTop=g),n):g},n.svg=function(t){return arguments.length?(l=t,n):l},n.viewport=function(t){return arguments.length?(f=t,n):f},n.delta=function(){return h},n.legendTitle=function(t){return legendTitle},n.lineNumber=function(t){return arguments.length?(y=t,n):y},n},n}function o(t){var o,a={};try{o=document&&!!document.documentMode}catch(t){o=!1}try{!o&&window&&!!window.StyleMedia}catch(t){!1}return a.init=function(t){var e=this,o={size:{width:800,height:600,margin:{left:0,right:0,top:0,bottom:0}}},a={chart:{backgroundColor:{color:"transparent"}},title:{textColor:"#E6B537",fontSize:"30px",fontWeight:600,textAlign:"center",hr:{enabled:!0,borderWidth:"1px",borderColor:"#fff"}},legend:{position:"bottom",figure:"circle",text:{textColor:"#fff",fontSize:"12px",fontWeight:600}},tooltip:{backgroundColor:"#757575",opacity:.9,text:{textColor:"#fff",fontSize:"12px",fontWeight:600,textAlign:"center",fontFamily:"sans-serif",padding:"0.8em"},border:{color:"#5A5C5D",radius:"5px",width:"1px"}},yAxis:{enabled:!0,axis:{strokeWidth:3,strokeColor:"#5F6C6C",strokeOpacity:0,paddingTick:0},ticks:{strokeWidth:3,strokeColor:"#929D9E",grid:"dashed",gridDashed:"3, 5",opacity:.6},labels:{fontSize:12,fontWeight:600,textColor:"#fff",textAnchor:"end"},title:{fontSize:17,fontWeight:600,textColor:"#fff",textAnchor:"middle"}},xAxis:{enabled:!0,axis:{strokeWidth:3,strokeColor:"#5F6C6C",strokeOpacity:1,paddingTick:5},ticks:{strokeWidth:1,strokeColor:"#5F6C6C"},labels:{fontSize:12,fontWeight:400,textColor:"#fff",textAnchor:"middle"},title:{fontSize:17,fontWeight:600,textColor:"#fff",textAnchor:"middle"}}};e._config=t?n.cloneDeep(t):o,e._config.xAxis&&(e._config.xAxis.axis="xAxis",void 0===e._config.xAxis.decimals&&void 0!==e._config.decimals&&(e._config.xAxis.decimals=e._config.decimals),void 0===e._config.xAxis.formatPreffix&&void 0!==e._config.formatPreffix&&(e._config.xAxis.formatPreffix=e._config.formatPreffix),void 0===e._config.xAxis.formatSuffix&&void 0!==e._config.formatSuffix&&(e._config.xAxis.formatSuffix=e._config.formatSuffix)),e._config.yAxis&&(e._config.yAxis.axis="yAxis",void 0===e._config.yAxis.decimals&&void 0!==e._config.decimals&&(e._config.yAxis.decimals=e._config.decimals),void 0===e._config.yAxis.formatPreffix&&void 0!==e._config.formatPreffix&&(e._config.yAxis.formatPreffix=e._config.formatPreffix),void 0===e._config.yAxis.formatSuffix&&void 0!==e._config.formatSuffix&&(e._config.yAxis.formatSuffix=e._config.formatSuffix)),e._data=[],e._margin=e._config.size.margin,e._addStyle=e._config.addStyle?e._config.addStyle:a,e._width=e._config.size.width-e._margin.left-e._margin.right,e._height=e._config.size.height-e._margin.top-e._margin.bottom,e._svg="",e._scales={},e._axes={},e.layers=[],e.helper=i.bind(e)()},a.config=function(t){var e=this;return e._config=n.cloneDeep(t),e},a.size=function(t){var e=this;return t&&(t.margin&&(Number.isNaN(+t.margin.left)||(e._config.size.margin.left=t.margin.left,e._margin.left=t.margin.left),Number.isNaN(+t.margin.right)||(e._config.size.margin.right=t.margin.right,e._margin.right=t.margin.right),Number.isNaN(+t.margin.top)||(e._config.size.margin.top=t.margin.top,e._margin.top=t.margin.top),Number.isNaN(+t.margin.bottom)||(e._config.size.margin.bottom=t.margin.bottom,e._margin.bottom=t.margin.bottom)),Number.isNaN(+t.width)||(e._config.size.width=t.width,e._width=t.width),Number.isNaN(+t.height)||(e._config.size.height=t.height,e._height=t.height)),e},a.addStyle=function(t){var e=this;return t&&(e._addStyle=t),e},a.grid=function(t){var e=this;return e._config.grid=!!t,e},a.bindTo=function(t){var e=this;return e._config.bindTo=t,e},a.data=function(t){var e=this;return void 0!==e._config.data?e._config.data=Object.assign({},e._config.data,t):e._config.data=t,e},a.legend=function(t){var e=this;return e._config.legend=t,e},a.legendType=function(t){var e=this;return e._config.legendType=t,e},a.legendTitle=function(t){var e=this;return e._config.legendTitle=t,e},a.layer=function(t,e){var n,i=this,o=e||i._config;if(void 0!==t||null!==t)return n=t(o,i.helper),i.layers.push(n),n},a.getLayer=function(t){return this.layers[t]},a.draw=function(){var t,e=this;return e._scales=e.scales(),t=e.loadData(),t.awaitAll(function(t,n){if(t)throw t;Array.isArray(n)&&1===n.length?e._data=n[0]:e._data=n,e.initLayers(),e.drawSVG(),e._axes=e.axes(),e.drawAxes(),e.drawLayers(),e._config.events&&e._config.events.load&&e.dispatch.on("load.chart",e._config.events.load(e))}),e},a.addStyle=function(t){var e=this;return e._addStyle=t,e},a.scales=function(){var t=this,n={};if(t._config.xAxis&&t._config.xAxis.scale)switch(t._config.xAxis.scale){case"linear":n.x=e.scaleLinear().range([0,t._width]);break;case"time":n.x=e.scaleTime().range([0,t._width]);break;case"ordinal":n.x=e.scaleOrdinal().range([0,t._width],.1);break;case"band":n.x=e.scaleBand().rangeRound([0,t._width]).padding(.1);break;case"quantile":n.x=e.scaleOrdinal().range([0,t._width],.1),n.q=e.scaleQuantile().range(e.range(t._config.xAxis.buckets));break;default:n.x=e.scaleLinear().range([0,t._width])}else n.x=e.scaleLinear().range([0,t._width]);if(t._config.yAxis&&t._config.yAxis.scale)switch(t._config.yAxis.scale){case"linear":n.y=e.scaleLinear().range([t._height,0]);break;case"time":n.y=e.scaleTime().range([t._height,0]);break;case"ordinal":n.y=e.scaleOrdinal().range([t._height,0],.1);break;case"band":n.y=e.scaleBand().rangeRound([t._height,0]).padding(.1);break;case"quantile":n.y=e.scaleOrdinal().range([0,t._width],.1),n.q=e.scaleQuantile().range(e.range(t._config.yAxis.buckets));break;default:n.y=e.scaleLinear().range([t._height,0])}else n.y=e.scaleLinear().range([t._height,0]);return n.color=e.scaleOrdinal(e.schemeCategory10),t._config.legend&&t._config.legend.length>0&&n.color.domain(t._config.legend.map(function(t){return t.name})),n},a.setScales=function(){},a.axes=function(){var t=this,n={};if(n.x=e.axisBottom(t._scales.x),n.y=e.axisLeft(t._scales.y),n.x.tickSizeOuter(0),n.y.tickSizeOuter(0),t._config.xAxis&&t._config.xAxis.ticks&&!0===t._config.xAxis.ticks.enabled&&t._config.xAxis.ticks.style)switch(t._config.xAxis.ticks.style){case"straightLine":n.x.tickSize(-t._height,0);break;case"dashLine":n.x.tickSize(-t._width,0)}if(t._addStyle.xAxis.ticks.grid)switch(t._addStyle.xAxis.ticks.grid){case"straight":case"dashed":n.y.tickSize(-t._width,0)}if(t._config.xAxis&&t._config.xAxis.ticks&&t._config.xAxis.ticks.ticks&&n.x.ticks(t._config.xAxis.ticks.ticks),t._config.xAxis&&t._config.xAxis.ticks&&t._config.xAxis.ticks.values&&n.x.tickValues(t._config.xAxis.ticks.values),t._config.xAxis&&t._config.xAxis.ticks&&"linear"===t._config.xAxis.scale&&(t._scales.x.domain()[1],n.x.tickFormat(t.helper.utils.format(t._config.xAxis,!0))),t._config.xAxis&&t._config.xAxis.ticks&&t._config.xAxis.ticks.format&&n.x.tickFormat(t._config.xAxis.ticks.format),t._config.yAxis&&t._config.yAxis.ticks&&!0===t._config.yAxis.ticks.enabled&&t._config.yAxis.ticks.style)switch(t._config.yAxis.ticks.style){case"straightLine":case"dashLine":n.y.tickSize(-t._width,0)}if(t._addStyle.yAxis.ticks.grid)switch(t._addStyle.yAxis.ticks.grid){case"straight":case"dashed":n.y.tickSize(-t._width,0)}return t._config.yAxis&&t._config.yAxis.ticks&&"linear"===t._config.yAxis.scale&&n.y.tickFormat(t.helper.utils.format(t._config.yAxis,!0)),t._config.yAxis&&t._config.yAxis.ticks&&t._config.yAxis.ticks.format&&n.y.tickFormat(t._config.yAxis.ticks.format),t._config.yAxis&&t._config.yAxis.ticks&&t._config.yAxis.ticks.ticks&&n.y.ticks(t._config.yAxis.ticks.ticks),n},a.loadData=function(){var t,n=this;return n._config.data.tsv&&(t=e.queue().defer(e.tsv,n._config.data.tsv)),n._config.data.json&&(t=e.queue().defer(e.json,n._config.data.json)),n._config.data.csv&&(t=e.queue().defer(e.csv,n._config.data.csv)),n._config.data.raw&&(t=e.queue().defer(n.mapData,n._config.data.raw)),n._config.map&&n._config.map.topojson&&n._config.map.topojson.url&&t.defer(e.json,n._config.map.topojson.url),t},a.initLayers=function(){var t=this;t.layers.forEach(function(e){e.data(t._data).scales(),t._scales=e._scales})},a.drawSVG=function(){var t=this;if(e.select(t._config.bindTo).select("svg").remove(),e.select(t._config.bindTo).html(""),t._config.template&&e.select(t._config.bindTo).classed(t._config.template,!0),t._config&&t._config.title&&(e.select(t._config.bindTo).append("div").attr("class","chart-title").html(t._config.title).style("display","flex").style("justify-content","center").style("align-items","center").style("font-size",t._addStyle.title.fontSize).style("font-weight",t._addStyle.title.fontWeight).style("color",t._addStyle.title.textColor).style("text-align",t._addStyle.title.textAlign),t._addStyle.title.hr.enabled&&e.select(t._config.bindTo).append("hr").attr("class","hr-title").style("width","80%").style("margin-left","10%").style("margin-top","0.5em").style("border-width",t._addStyle.title.hr.borderWidth).style("border-color",t._addStyle.title.hr.borderColor)),t._config.legend&&!0===t._config.legend.enabled&&"top"===t._config.legend.position){var n=e.select(t._config.bindTo).append("div").attr("class","chart-legend-top"),i="";i+='<div style="background-color:#E2E2E1;text-align:center;height: 40px;margin: 0px 15px">',t._config.legend.categories.forEach(function(t){i+='<div class="dbox-legend-category-title" style="margin:0 20px;"><span class="dbox-legend-category-color" style="background-color:'+t.color+';"> </span><span style="height: 10px;float: left;margin: 10px 5px 5px 5px;border-radius: 50%;">'+t.title+"</span></div>"}),i+="</div>",n.html(i)}var o=t._width+t._margin.left+t._margin.right,a=t._height+t._margin.top+t._margin.bottom;t._fullSvg=e.select(t._config.bindTo).append("svg").style("font-size",t._config.chart&&t._config.chart["font-size"]?t._config.chart["font-size"]:"12px").attr("width",o).attr("height",a).attr("viewBox","0 0 "+o+" "+a),t._svg=t._fullSvg.append("g").attr("transform","translate("+t._margin.left+","+t._margin.top+")"),e.select(t._config.bindTo+" svg").style("background-color",t._addStyle.chart.backgroundColor.color),t._config.hasOwnProperty("legend")&&!0===t._config.legendEnabled&&t.drawLegend()},a.drawLayers=function(){this.layers.forEach(function(t){t.draw()})},a.drawLegend=function(){var t,n,i=this,o=i._config.size.width-i._config.size.margin.right+10,a=i._config.size.margin.top+10;!i._scales.color&&i._config.colors&&(i._scales.color=e.scaleOrdinal(i._config.colors)),i._config.legend&&i._config.legend.length>0&&i._scales.color.domain(i._config.legend.map(function(t){return t.name}));var r=i.helper.utils.d3.tip().html(function(t){return'<div class="title-tip">'+(t.name||t)+"</div>"});if(i._fullSvg.call(r),t=i._fullSvg.append("g").attr("class","legendBox").attr("transform","translate("+o+", "+a+")").attr("width",i._width).attr("height",i._height),i._config.legendTitle){t.append("g").attr("width","150px").append("text").attr("class","legend-title").attr("x",5).style("font-weight","bold").text(i._config.legendTitle);for(var s,c=i._config.size.margin.right,l=e.selectAll(".legend-title"),f=l.text().split(/\s+/).reverse(),u=[],g=1,d=1.1,_=l.attr("y"),p=l.text(null).append("tspan").attr("x",0).attr("y",_).attr("dy","0em");s=f.pop();)u.push(s),p.text(u.join(" ")),p.node().getComputedTextLength()>c&&(u.pop(),p.text(u.join(" ")),u=[s],++g,p=l.append("tspan").attr("x",-6).attr("y",_).attr("dy",d+"em").text(s))}var x=.8*i._config.size.margin.right;if("checkbox"===i._config.legendType){i._scales.color.domain(i._config.legend.map(function(t){return t.name}));var h=function(t){t.append("rect").attr("width",18).attr("height",18).attr("x",0).attr("rx",2).attr("ry",2).attr("fill-opacity",1);var n=[{x:2.25,y:9},{x:0+18/2.2,y:13.5},{x:15.75,y:1.8}],o=e.line().x(function(t){return t.x}).y(function(t){return t.y});t.append("path").attr("d",o(n)).attr("stroke-width",3).attr("stroke","white").attr("fill","none").attr("class","mark").property("checked",function(t){return t.active}).attr("opacity",function(){return e.select(this).property("checked")?1:0}),t.append("text").attr("class","labelText").attr("x",20).attr("y",9).attr("dy",".35em").attr("text-anchor","start"),t.select("rect").attr("fill",function(t){return i._scales.color(t.name)}),t.select("text").text(function(t){return t.name}),t.selectAll("text").each(function(t){var n=this;if("string"==typeof t.name){if(!(this.getComputedTextLength()>x))return t;!function(){e.select(n).attr("title",t.name).on("mouseover",r.show).on("mouseout",r.hide);for(var i=1;n.getComputedTextLength()>x;)e.select(n).text(function(t){return t.name.slice(0,-i)+"..."}),++i}()}})};t.append("rect").attr("class","legendBoxBackground").attr("width","160px").attr("height","90%").attr("transform","translate(0,0)").style("fill","transparent");var y=function(t){t.select("rect").attr("fill",function(t){return i._scales.color(t.name)}),t.select("text").text(function(t){return t.name}),t.selectAll("text").each(function(t){var n=this;if("string"==typeof t.name){if(!(this.getComputedTextLength()>x))return t;!function(){e.select(n).attr("title",t.name).on("mouseover",r.show).on("mouseout",r.hide);for(var i=1;n.getComputedTextLength()>x;)e.select(n).text(function(t){return t.name.slice(0,-i)+"..."}),++i}()}})},m=function(t){};n=i.helper.utils.VirtualScroller().rowHeight(18).enter(h).update(y).exit(m).svg(i._fullSvg).totalRows(i._config.legend.length).viewport(e.select(".empty-chart")).lineNumber(g),n.data(i._config.legend,function(t){return t.name}),t.call(n)}else{var v;v=i._config.styles&&"bottom"===i._addStyle.legend.position?t.selectAll(".legend").data(i._config.legend).enter().append("g").attr("class","legend").attr("width",i._width/(i._config.legend.length+1)).attr("transform",function(t,e){return"translate("+i._width/(i._config.legend.length+1)*e+","+19*(i._config.legendTitle&&g>1?g*d:0)+")"}):t.selectAll(".legend").data(i._config.legend).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(5,"+19*(i._config.legendTitle&&g>1?g*d+e:1+e)+")"}),"circle"===i._addStyle.legend.figure?v.append("circle").attr("cx",2).attr("cy",9).attr("r",7).attr("stroke-width",2).attr("stroke",function(t){return i._scales.color(t.name)}).attr("fill",function(t){return i._scales.color(t.name)}).attr("fill-opacity",.8):v.append("rect").attr("x",0).attr("width",18).attr("height",18).attr("fill",function(t){return i._scales.color(t.name)}),v.append("text").attr("x",20).attr("y",9).attr("dy",".35em").attr("text-anchor","start").text(function(t){return t.name});var b=i._config.size.margin.right-19;v.selectAll("text").each(function(t){var n=this;if("string"==typeof t.name){if(!(this.getComputedTextLength()>b))return t;!function(){e.select(n).attr("title",t.name).on("mouseover",r.show).on("mouseout",r.hide);for(var i=1;n.getComputedTextLength()>b;)e.select(n).text(function(t){return t.name.slice(0,-i)+"..."}),++i}()}})}t.selectAll(".legend text").attr("fill",i._addStyle.legend.text.textColor).attr("font-size",i._addStyle.legend.text.fontSize).attr("font-weight",i._addStyle.legend.text.fontWeight);var A="undefined"!=typeof InstallTrigger,w="onwheel"in e.select(".legendBox")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";A&&(w="wheel"),e.select(".legendBoxBackground").on(w,function(){e.event.preventDefault()}),e.select(".scroll-legend").on(w,function(){e.event.preventDefault()}),t.selectAll("text").on(w,function(){e.event.preventDefault()}),t.selectAll("rect").on(w,function(){e.event.preventDefault()}),t.selectAll("path").on(w,function(){e.event.preventDefault()})},a.drawGrid=function(){return this},a.drawAxes=function(){var t,n=this,i=n.helper.utils.d3.tip().html(function(t){return'<div class="title-tip">'+t+"</div>"});if((!n._config.yAxis||n._config.yAxis&&!1!==n._config.yAxis.enabled)&&(!n._config.xAxis||n._config.xAxis&&!1!==n._config.xAxis.enabled)&&n._svg.call(i),(!n._config.yAxis||n._config.yAxis&&!1!==n._config.yAxis.enabled)&&(t=n._svg.append("g").attr("class","y axis").call(n._axes.y),n._config.yAxis&&n._config.yAxis.text&&t.append("text").attr("class","axis-title").attr("y",.7*-n._margin.left).attr("x",-n._height/2).attr("transform","rotate(-90)").attr("text-anchor","middle").text(n._config.yAxis.text),n._config.yAxis&&n._config.yAxis.scaleText&&t.append("text").attr("class","axis-scale-title").attr("y",-12).attr("x",-12).attr("font-weight","bold").attr("text-anchor","middle").text(n._config.yAxis.scaleText)),n._config.yAxis.domain&&n._config.yAxis.domain.hasOwnProperty("enabled")&&(n._config.yAxis.ticks?!1===n._config.yAxis.domain.enabled&&!1===n._config.yAxis.ticks.enabled?(e.select("g.y.axis .domain").remove(),e.selectAll("g.y.axis .tick").remove()):!1===n._config.yAxis.domain.enabled&&!0===n._config.yAxis.ticks.enabled&&e.select("g.y.axis .domain").remove():!1===n._config.yAxis.domain.enabled&&(e.select("g.y.axis .domain").remove(),e.selectAll("g.y.axis .tick").remove())),(!n._config.yAxis||n._config.yAxis&&!1!==n._config.yAxis.enabled)&&t.selectAll("text").each(function(t){var o=this,a=this;if("string"==typeof t){if(!(this.getComputedTextLength()>.8*n._margin.left))return t;!function(){e.select(a).on("mouseover",i.show).on("mouseout",i.hide);for(var r=1;o.getComputedTextLength()>.8*n._margin.left;)e.select(o).text(function(t){return t.slice(0,-r)+"..."}).attr("title",t),++r}()}}),n._config.yAxis&&n._config.yAxis.dropdown&&!0===n._config.yAxis.dropdown.enabled){var o=e.select(n._config.bindTo).append("div").attr("class","dbox-yAxis-select").append("select").on("change",function(){n.updateAxis("y",this.value)}),a=-1*e.select(n._config.bindTo).node().getBoundingClientRect().width/2+n._margin.left/2.5,r=-1*e.select(n._config.bindTo).node().getBoundingClientRect().height/1.5;if(n._config.yAxis.dropdown.styles){var s=n._config.yAxis.dropdown.styles;s.display="block",s.transform="translate("+a+"px,"+r+"px) rotate(-90deg)",s.margin="auto",s["text-align"]="center",s["text-align-last"]="center",e.select(".dbox-yAxis-select select").styles(s),e.select(".dbox-yAxis-select select option").styles({"text-align":"left"})}else e.select(".dbox-yAxis-select select").styles({display:"block",transform:"translate("+a+"px,"+r+"px) rotate(-90deg)",margin:"auto","text-align":"center","text-align-last":"center"}),e.select(".dbox-yAxis-select select option").styles({"text-align":"left"});n._config.yAxis.dropdown.options?o.selectAll("option").data(n._config.yAxis.dropdown.options).enter().append("option").attr("class",function(t){return t.value}).attr("value",function(t){return t.value}).text(function(t){return t.title}).property("selected",function(t){return t.selected}):console.log("No options present in config")}if((!n._config.xAxis||n._config.xAxis&&!1!==n._config.xAxis.enabled)&&(n._xAxis=n._svg.append("g").attr("class","x axis").attr("transform","translate(0,"+n._height+")").call(n._axes.x),"linear"===n._config.yAxis.scale&&n._scales.y.domain()[0]<0&&n._xAxis.select(".domain").attr("transform","translate(0,-"+Math.abs(n._scales.y.range()[0]-n._scales.y(0))+")"),n._config.xAxis.line&&!1===n._config.xAxis.line.enabled&&n._xAxis.selectAll("path").style("display","none"),n._config.xAxis.ticks&&n._config.xAxis.ticks.x&&n._xAxis.selectAll("text").attr("dx",n._config.xAxis.ticks.x),n._config.xAxis.ticks&&n._config.xAxis.ticks.y&&n._xAxis.selectAll("text").attr("dy",n._config.xAxis.ticks.y),n._config.xAxis.ticks&&n._config.xAxis.ticks.line&&!1===n._config.xAxis.ticks.line.enabled&&n._xAxis.selectAll("line").style("display","none")),n._config.xAxis&&n._config.xAxis.text&&n._svg.select(".x.axis").append("text").attr("class","axis-title").attr("x",n._width/2).attr("y",40).style("text-anchor","middle").text(n._config.xAxis.text),n._config.xAxis&&n._config.xAxis.scaleText&&n._xAxis&&n._xAxis.append("text").attr("class","axis-scale-title").attr("x",n._width).attr("y",15).style("text-anchor","start").text(n._config.xAxis.scaleText),void 0!==n._config.xAxis.domain&&n._config.xAxis.domain.hasOwnProperty("enabled")&&(n._config.xAxis.ticks?!1===n._config.xAxis.domain.enabled&&!1===n._config.xAxis.ticks.enabled?(e.select(n._config.bindTo+" g.x.axis .domain").remove(),e.selectAll("g.x.axis .tick").remove()):!1===n._config.xAxis.domain.enabled&&!0===n._config.xAxis.ticks.enabled&&e.select(n._config.bindTo+" g.x.axis .domain").remove():!1===n._config.xAxis.domain.enabled&&(e.select(n._config.bindTo+" g.x.axis .domain").remove(),e.selectAll(n._config.bindTo+" g.x.axis .tick").remove())),n._config.xAxis&&n._config.xAxis.dropdown&&!0===n._config.xAxis.dropdown.enabled){var c=e.select(n._config.bindTo).append("div").attr("class","dbox-xAxis-select").append("select").on("change",function(){n.updateAxis("x",this.value)});if(n._config.xAxis.dropdown.styles){var s=n._config.xAxis.dropdown.styles;s.display="block",s.margin="auto",s["text-align"]="center",s["text-align-last"]="center",e.select(".dbox-xAxis-select select").styles(s),e.select(".dbox-xAxis-select select option").styles({"text-align":"left"})}else e.select(".dbox-xAxis-select select").styles({display:"block",margin:"auto","text-align":"center","text-align-last":"center"}),e.select(".dbox-xAxis-select select option").styles({"text-align":"left"});n._config.xAxis.dropdown.options?c.selectAll("option").data(n._config.xAxis.dropdown.options).enter().append("option").attr("class",function(t){return t.value}).attr("value",function(t){return t.value}).text(function(t){return t.title}).property("selected",function(t){return t.selected}):console.log("No options present in config")}!1!==n._config.yAxis.enabled&&n._addStyle.yAxis.enabled&&(t.selectAll(".domain").attr("stroke-linecap","round").attr("stroke-width",n._addStyle.yAxis.axis.strokeWidth).attr("stroke",n._addStyle.yAxis.axis.strokeColor).attr("opacity",n._addStyle.yAxis.axis.strokeOpacity),t.selectAll(".axis-title").attr("font-size",n._addStyle.yAxis.title.fontSize).attr("font-weight",n._addStyle.yAxis.title.fontWeight).attr("fill",n._addStyle.yAxis.title.textColor).attr("text-anchor",n._addStyle.yAxis.title.textAnchor),t.selectAll(".tick line").attr("stroke-width",n._addStyle.yAxis.ticks.strokeWidth).attr("stroke",n._addStyle.yAxis.ticks.strokeColor).attr("stroke-opacity",n._addStyle.yAxis.ticks.opacity).attr("width",n._addStyle.yAxis.ticks.tickWidth).attr("stroke-dasharray",n._addStyle.yAxis.ticks.gridDashed).attr("transform","translate(-"+n._addStyle.yAxis.axis.paddingTick+", 0)"),n._addStyle.yAxis.ticks.grid&&t.selectAll(".tick:first-of-type line:first-of-type").attr("stroke","none"),t.selectAll(".tick text").attr("font-size",n._addStyle.yAxis.labels.fontSize).attr("font-weight",n._addStyle.yAxis.labels.fontWeight).attr("fill",n._addStyle.yAxis.labels.textColor).attr("text-anchor",n._addStyle.yAxis.labels.textAnchor).attr("transform","translate(-"+n._addStyle.yAxis.axis.paddingTick+", 0)")),!1!==n._config.xAxis.enabled&&n._addStyle.xAxis.enabled&&(n._xAxis.selectAll(".domain").attr("stroke-linecap","round").attr("stroke-width",n._addStyle.xAxis.axis.strokeWidth).attr("stroke",n._addStyle.xAxis.axis.strokeColor).attr("opacity",n._addStyle.xAxis.axis.strokeOpacity),n._xAxis.selectAll(".tick line").attr("stroke-width",n._addStyle.xAxis.ticks.strokeWidth).attr("stroke",n._addStyle.xAxis.ticks.strokeColor).attr("transform","translate(0, "+n._addStyle.xAxis.axis.paddingTick+")"),n._addStyle.xAxis.ticks.grid&&n._xAxis.selectAll(".tick:first-of-type line:first-of-type").attr("stroke","none"),n._xAxis.selectAll(".tick text").attr("font-size",n._addStyle.xAxis.labels.fontSize).attr("font-weight",n._addStyle.xAxis.labels.fontWeight).attr("fill",n._addStyle.xAxis.labels.textColor).attr("text-anchor",n._addStyle.xAxis.labels.textAnchor).attr("transform",n._addStyle.xAxis.labels.rotate?"translate(0,55) rotate("+n._addStyle.xAxis.axis.labels.rotate+")":"translate(0, "+n._addStyle.xAxis.axis.paddingTick+")"));var l=e.max(e.select(".x.axis").selectAll("text").nodes().map(function(t){return t.getComputedTextLength()}));if(!n._config.xAxis||n._config.xAxis&&!1!==n._config.xAxis.enabled){l>(n._scales.x.bandwidth?n._scales.x.bandwidth():(n._config.size.width-(n._config.size.margin.left+n._config.size.margin.right))/n._scales.x.ticks())-5&&(n._addStyle.xAxis.labels.rotate=!0,n._xAxis.selectAll("text").each(function(t){var o=this;if("string"==typeof t){if(e.select(this).attr("text-anchor","end").attr("dy",0).attr("transform","translate(-6,12)rotate(-90)"),!(this.getComputedTextLength()>.8*n._config.size.margin.bottom))return t;!function(){e.select(o).on("mouseover",i.show).on("mouseout",i.hide);for(var a=1;o.getComputedTextLength()>.8*n._config.size.margin.bottom;)e.select(o).text(function(t){return t.slice(0,-a)+"..."}).attr("title",t),++a}()}}))}if(!1!==n._config.xAxis.enabled&&n._addStyle.xAxis.enabled&&n._xAxis.selectAll(".axis-title").attr("font-size",n._addStyle.xAxis.title.fontSize).attr("font-weight",n._addStyle.xAxis.title.fontWeight).attr("fill",n._addStyle.xAxis.title.textColor).attr("text-anchor",n._addStyle.xAxis.title.textAnchor).attr("transform","translate(0, "+(n._addStyle.xAxis.labels.rotate?e.min([.7*n._config.size.margin.bottom,l]):n._addStyle.xAxis.axis.paddingTick)+")"),n._config.yAxis.ticks&&n._config.yAxis.ticks.enabled&&n._config.yAxis.ticks.style)switch(n._config.yAxis.ticks.style){case"straightLine":break;case"dashLine":e.selectAll("g.y.axis .tick line").attr("stroke-dasharray","5, 5")}if(n._config.yAxis.domain&&n._config.yAxis.domain.enabled&&n._config.yAxis.domain.stroke&&e.select("g.y.axis .domain").attr("stroke",n._config.yAxis.domain.stroke),
n._config.yAxis.domain&&n._config.yAxis.domain.enabled&&n._config.yAxis.domain["stroke-width"]&&e.select("g.y.axis .domain").attr("stroke-width",n._config.yAxis.domain["stroke-width"]),(!n._config.xAxis||n._config.xAxis&&!1!==n._config.xAxis.enabled)&&(n._config.xAxis.ticks&&n._config.xAxis.ticks.style&&Object.keys(n._config.xAxis.ticks.style).forEach(function(t){n._xAxis.selectAll("text").style(t,n._config.xAxis.ticks.style[t])}),n._config.xAxis.ticks&&n._config.xAxis.ticks.rotate&&n._xAxis.selectAll("text").attr("text-anchor","end").attr("transform","rotate("+n._config.xAxis.ticks.rotate+")"),n._config.xAxis.ticks&&n._config.xAxis.ticks.enabled&&n._config.xAxis.ticks.style))switch(n._config.xAxis.ticks.style){case"straightLine":break;case"dashLine":e.selectAll(n._config.bindTo+" g.x.axis .tick line").attr("stroke-dasharray","5, 5")}n._config.xAxis.domain&&n._config.xAxis.domain.enabled&&n._config.xAxis.domain.stroke&&e.select(n._config.bindTo+" g.x.axis .domain").attr("stroke",n._config.xAxis.domain.stroke),n._config.xAxis.domain&&n._config.xAxis.domain.enabled&&n._config.xAxis.domain["stroke-width"]&&e.select(n._config.bindTo+" g.x.axis .domain").attr("stroke-width",n._config.xAxis.domain["stroke-width"])},a.updateAxis=function(t,e){var n=this;"x"===t?n._config.xAxis.dropdown.options.map(function(t){t.value===e?t.selected=!0:t.selected=!1}):"y"===t&&n._config.yAxis.dropdown.options.map(function(t){t.value===e?t.selected=!0:t.selected=!1}),n._config[t]=e,n.layers[0]._config=n._config,n.draw(),n._config.events&&n._config.events.change&&n.dispatch.on("change.axis",n._config.events.change(n))},a.dispatch=e.dispatch("load","change"),a.mapData=function(t,e){e(null,t)},a.getDomains=function(t){var n=this,i={},o=[],a=[],r=function(t,e){return n.utils.sortAscending(t.y,e.y)},s=function(t,e){return n.utils.sortAscending(t.x,e.x)};if(n._config.data.sort&&n._config.data.sort.order)switch(n._config.data.sort.order){case"asc":r=function(t,e){return n.utils.sortAscending(t.y,e.y)},s=function(t,e){return n.utils.sortAscending(t.x,e.x)};break;case"desc":r=function(t,e){return n.utils.sortDescending(t.y,e.y)},s=function(t,e){return n.utils.sortDescending(t.x,e.x)}}if(n._config.xAxis&&n._config.xAxis.scale)switch(n._config.xAxis.scale){case"linear":case"time":o=e.extent(t,function(t){return t.x}),i.x=o;break;case"ordinal":a=n._config.data.sort&&"y"===n._config.data.sort.axis?t.sort(r):t.sort(s),i.x=[],a.forEach(function(t){i.x.push(t.x)});break;case"quantile":a=n._config.data.sort&&"y"===n._config.data.sort.axis?t.sort(r):t.sort(s),i.q=[],a.forEach(function(t){i.q.push(t.x)}),i.x=e.range(n._config.xAxis.buckets);break;default:o=e.extent(t,function(t){return t.x}),i.x=o}else o=e.extent(t,function(t){return t.x}),i.x=o;if(n._config.yAxis&&n._config.yAxis.scale)switch(n._config.yAxis.scale){case"linear":o=e.extent(t,function(t){return t.y}),o[0]>0&&(o[0]=o[0]-.1*(o[1]-o[0])),i.y=o;break;case"time":o=e.extent(t,function(t){return t.y}),i.y=o;break;case"ordinal":n._config.data.sort&&"y"===n._config.data.sort.axis?(a=t.sort(function(t,e){return n.utils.sortAscending(t.y,e.y)}),i.y=[],a.forEach(function(t){i.y.push(t.x)})):i.y=e.map(t,function(t){return t.y}).keys().sort(function(t,e){return n.utils.sortAscending(t,e)});break;default:o=e.extent(t,function(t){return t.y}),i.y=o}else o=e.extent(t,function(t){return t.y}),i.y=o;return i},a.destroy=function(){var t=this;e.select(t._config.bindTo).html("")},a.init(t),a}function a(t,i){var o=Object.create(i);return o.init=function(t){var e=this;e._config=t||{},e._data=[],e._scales={},console.log(e._config),e._tip=e.utils.d3.tip().attr("class","d3-tip "+(e._config.tooltip&&e._config.tooltip.classed?e._config.tooltip.classed:"")).direction("n").html(e._config.tip||function(t){var n="";return n+=t[e._config.x]?"<span>"+(Number.isNaN(+t[e._config.x])||"band"===e._config.xAxis.scale?t[e._config.x]:e.utils.format(e._config.xAxis)(t[e._config.x]))+"</span></br>":"",n+=t[e._config.y]?"<span>"+(Number.isNaN(+t[e._config.y])||"band"===e._config.yAxis.scale?t[e._config.y]:e.utils.format(e._config.yAxis)(t[e._config.y]))+"</span></br>":""})},o.id=function(t){var e=this;return e._config.id=t,e},o.x=function(t){var e=this;return e._config.x=t,e},o.y=function(t){var e=this;return e._config.y=t,e},o.groupBy=function(t){var e=this;return e._config.groupBy=t,e},o.stackBy=function(t){var e=this;return e._config.stackBy=t,e},o.fill=function(t){var e=this;return e._config.fill=t,e},o.colors=function(t){var e=this;return Array.isArray(t)?e._config.colors=t:e._scales.color=t,e},o.sortBy=function(t){var e=this;return e._config.sortBy=t,e},o.format=function(t){var n=this;return"function"==typeof t||t instanceof Function?n.utils.format=t:n.utils.format=e.format(t),n},o.tip=function(t){var e=this;return e._config.tip=t,e},o.legend=function(t){var e=this;return e._config.legend=t,e},o.data=function(t){var n=this;return n._config.filter&&(t=t.filter(n._config.filter)),n._config.hasOwnProperty("stackBy")&&Array.isArray(n._config.stackBy)&&n._config.stackBy.length>0?n._data=e.stack().keys(n._config.stackBy)(t):n._data=t.map(function(t){return t[n._config.x]==Number(t[n._config.x])&&(t[n._config.x]=+t[n._config.x]),t[n._config.y]==Number(t[n._config.y])&&(t[n._config.y]=+t[n._config.y]),t}),n._config.sortBy&&(n._data=n._data.sort(function(t,e){return t[n._config.sortBy[0]]-e[n._config.sortBy[0]]})),n._config.hasOwnProperty("quantiles")&&(n._quantiles=n._setQuasecondntile(t),n._minMax=e.extent(t,function(t){return+t[n._config.fill]})),n},o.scales=function(){var t,i=this;if(i._config.hasOwnProperty("x")&&i._config.hasOwnProperty("y")&&(t={column:i._config.x,type:i._config.xAxis.scale,range:[0,i.chart.width],minZero:i._config.xAxis.minZero},i._config.xAxis.domains&&(t.domains=i._config.xAxis.domains),i._scales.x=i.utils.generateScale(i._data,t),t={column:i._config.y,type:i._config.yAxis.scale,range:[i.chart.height,0],minZero:i._config.yAxis.minZero},i._config.yAxis.domains&&(t.domains=i._config.yAxis.domains),i._scales.y=i.utils.generateScale(i._data,t)),i._config.hasOwnProperty("x")&&i._config.hasOwnProperty("groupBy")&&(t={column:i._config.x,type:i._config.xAxis.scale,groupBy:"parent",range:[0,i.chart.width],minZero:i._config.xAxis.minZero},i._config.xAxis.domains&&(t.domains=i._config.xAxis.domains),i._scales.x=i.utils.generateScale(i._data,t),t={column:i._config.groupBy,type:"band",groupBy:"children",range:[0,i._scales.x.bandwidth()]},i._scales.groupBy=i.utils.generateScale(i._data,t),t={column:i._config.groupBy,type:i._config.yAxis.scale,groupBy:"data",range:[i.chart.height,0],minZero:i._config.yAxis.minZero},i._config.yAxis.domains&&(t.domains=i._config.yAxis.domains),i._scales.y=i.utils.generateScale(i._data,t)),i._config.hasOwnProperty("y")&&i._config.hasOwnProperty("groupBy")&&(t={column:i._config.y,type:i._config.yAxis.scale,groupBy:"parent",range:[0,i.chart.height],minZero:i._config.yAxis.minZero},i._config.yAxis.domains&&(t.domains=i._config.yAxis.domains),i._scales.y=i.utils.generateScale(i._data,t),t={column:i._config.groupBy,type:"band",groupBy:"children",range:[0,i._scales.y.bandwidth()]},i._scales.groupBy=i.utils.generateScale(i._data,t),t={column:i._config.groupBy,type:i._config.xAxis.scale,groupBy:"data",range:[0,i.chart.width],minZero:i._config.xAxis.minZero},i._config.xAxis.domains&&(t.domains=i._config.xAxis.domains),i._scales.x=i.utils.generateScale(i._data,t)),i._config.hasOwnProperty("x")&&i._config.hasOwnProperty("stackBy")&&(t={column:i._config.x,type:i._config.xAxis.scale,stackBy:"parent",range:[0,i.chart.width],minZero:i._config.xAxis.minZero},i._config.xAxis.domains&&(t.domains=i._config.xAxis.domains),i._scales.x=i.utils.generateScale(i._data,t),t={column:"",stackBy:"data",type:i._config.yAxis.scale,range:[i.chart.height,0],minZero:i._config.yAxis.minZero},i._config.yAxis.domains&&(t.domains=i._config.yAxis.domains),i._scales.y=i.utils.generateScale(i._data,t)),i._config.hasOwnProperty("y")&&i._config.hasOwnProperty("stackBy")&&(t={column:"",type:i._config.xAxis.scale,stackBy:"data",range:[0,i.chart.width],minZero:i._config.xAxis.minZero},i._config.xAxis.domains&&(t.domains=i._config.xAxis.domains),i._scales.x=i.utils.generateScale(i._data,t),t={column:i._config.y,stackBy:"parent",type:i._config.yAxis.scale,range:[i.chart.height,0],minZero:i._config.yAxis.minZero},i._config.yAxis.domains&&(t.domains=i._config.yAxis.domains),i._scales.y=i.utils.generateScale(i._data,t)),!i._scales.color||i._scales.color&&0===i._scales.color.domain().length)return i._config.hasOwnProperty("colors")?i._scales.color=e.scaleOrdinal(i._config.colors):i._scales.color=e.scaleOrdinal(e.schemeCategory10),i._data&&i._data.length>0&&i._scales.color.domain(n.uniq(i._data.map(function(t){return t[i._config.fill]}))),i._config.legend&&i._config.legend.length>0&&i._scales.color.domain(i._config.legend.map(function(t){return t.name})),i},o.drawLabels=function(){var t=this;t.chart.svg().selectAll(".dbox-label").data(t._data).enter().append("text").attr("class","dbox-label").attr("x",function(e){var n=t._scales.x(e[t._config.x]);return"linear"==t._config.xAxis.scale&&e[t._config.x]>0&&(n=t._scales.x(0)),n}).attr("y",function(e){var n=t._scales.y(e[t._config.y]),i=t._scales.y.bandwidth?t._scales.y.bandwidth():Math.abs(t._scales.y(e[t._config.y])-t._scales.y(0));return"linear"===t._config.yAxis.scale?e[t._config.y]<0&&(n=t._scales.y(0)):"linear"!==t._config.yAxis.scale&&(n+=i),n-7}).attr("transform",function(e){var n=t._scales.x.bandwidth?t._scales.x.bandwidth():Math.abs(t._scales.x(e[t._config.x])-t._scales.x(0));return isNaN(e[t._config.y])?"translate("+(n+30)+", 0)":"translate("+n/2+", 0)"}).attr("text-anchor","middle").text(function(e){return isNaN(e[t._config.y])?t.utils.format(t._config.xAxis)(e[t._config.x])?t.utils.format(t._config.xAxis,!0)(e[t._config.x]):"":t.utils.format(t._config.yAxis)(e[t._config.y])?t.utils.format(t._config.yAxis,!0)(e[t._config.y]):""})},o.draw=function(){var t=this;return t._config.hasOwnProperty("groupBy")?(t._config.hasOwnProperty("x")&&t._drawGroupByXAxis(),t._config.hasOwnProperty("y")&&t._drawGroupByYAxis(),t):t._config.hasOwnProperty("stackBy")?(t._config.hasOwnProperty("x")&&t._drawStackByXAxis(),t._config.hasOwnProperty("y")&&t._drawStackByYAxis(),t):(t.chart.svg().call(t._tip),t.chart.svg().selectAll(".bar").data(t._data).enter().append("rect").attr("class","bar").attr("id",function(e,n){var i="bars-"+n;return t._config.id&&(i="bars-"+e[t._config.id]),i}).attr("x",function(e){var n=t._scales.x(e[t._config.x]);return"linear"==t._config.xAxis.scale&&e[t._config.x]>0&&(n=t._scales.x(0)),n}).attr("y",function(e){var n=t._scales.y(e[t._config.y]);return"linear"===t._config.yAxis.scale&&e[t._config.y]<0&&(n=t._scales.y(0)),n}).attr("width",function(e){return t._scales.x.bandwidth?t._scales.x.bandwidth():Math.abs(t._scales.x(e[t._config.x])-t._scales.x(0))}).attr("height",function(e){return t._scales.y.bandwidth?t._scales.y.bandwidth():Math.abs(t._scales.y(e[t._config.y])-t._scales.y(0))}).attr("fill",function(e){return!1!==t._scales.color?t._scales.color(e[t._config.fill]):t._getQuantileColor(e[t._config.fill],"default")}).style("opacity",.9).on("mouseover",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"onHover")}),t._tip.show(n,e.select(this).node()),t._config.hasOwnProperty("onmouseover")&&t._config.onmouseover.call(this,n,i)}).on("mouseout",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"default")}),t._tip.hide(),t._config.hasOwnProperty("onmouseout")&&t._config.onmouseout.call(this,n,i)}).on("click",function(e,n){t._config.hasOwnProperty("click")&&t._config.onclick.call(this,e,n)}),o.drawLabels(),t)},o.drawGroupLabels=function(){var t=this;t.chart.svg().selectAll(".grouped").each(function(){var n=this;e.select(this).selectAll("rect").each(function(i,o){e.select(n).append("text").attr("class","dbox-label").attr("transform",function(e){var n=t._scales.groupBy.bandwidth();return t._config.x?"translate("+(t._scales.groupBy(t._config.groupBy[o])+n/2)+","+(t._scales.y(e[t._config.groupBy[o]])-7)+")":"translate("+(t._scales.x(e[t._config.groupBy[o]])+26)+","+(t._scales.groupBy(t._config.groupBy[o])+n)+")"}).attr("text-anchor","middle").text(function(e){return e[t._config.groupBy[o]]?t.utils.format(void 0,!0)(e[t._config.groupBy[o]]):""}),e.select(n).append("text").attr("class","dbox-label-coefficient").attr("transform",function(e){return t._config.x?Math.abs(t._scales.y(e[t._config.groupBy[o]])-t._scales.y(0))<50?"translate("+(t._scales.groupBy(t._config.groupBy[o])+30)+","+t._scales.y(e[t._config.groupBy[o]])+")":"translate("+(t._scales.groupBy(t._config.groupBy[o])+30)+","+(t._scales.y(e[t._config.groupBy[o]])+40)+")":"translate("+(t._scales.x(e[t._config.groupBy[o]])+26)+","+(t._scales.groupBy(t._config.groupBy[o])+30)+")"}).attr("text-anchor","middle").text(function(e){return e[t._config.groupBy[o]+"coefficient"]&&!Number.isNaN(e[t._config.groupBy[o]+"coefficient"])?"("+e[t._config.groupBy[o]+"coefficient"].toFixed(1)+")":""})})})},o._drawGroupByXAxis=function(){var t=this;t._tip.html(t._config.tip||function(e){var n=e.key+"<br>";return e.axis!==e.key&&(n+=e.axis+"<br>"),n+=t.utils.format()(e.value)}),t.chart.svg().call(t._tip),t.chart.svg().append("g").selectAll("g").data(t._data).enter().append("g").attr("class","grouped").attr("transform",function(e){return"translate("+t._scales.x(e[t._config.x])+",0)"}).selectAll("rect").data(function(e){return t._config.groupBy.map(function(n){return{key:n,value:e[n],axis:e[t._config.x]}})}).enter().append("rect").attr("x",function(e){return t._scales.groupBy(e.key)}).attr("y",function(e){return e.value>0?t._scales.y(e.value):t._scales.y(0)}).attr("width",t._scales.groupBy.bandwidth()).attr("height",function(e){return Math.abs(t._scales.y(e.value)-t._scales.y(0))}).attr("fill",function(e){return t._scales.color(e.key)}).on("mouseover",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"onHover")}),t._tip.show(n,e.select(this).node()),t._config.hasOwnProperty("onmouseover")&&t._config.onmouseover.call(this,n,i)}).on("mouseout",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"default")}),t._tip.hide(),t._config.hasOwnProperty("onmouseout")&&t._config.onmouseout.call(this,n,i)}).on("click",function(e,n){t._config.hasOwnProperty("click")&&t._config.onclick.call(this,e,n)}),o.drawGroupLabels()},o._drawGroupByYAxis=function(){var t=this;t._tip.html(t._config.tip||function(e){var n=e.key+"<br>";return e.axis!==e.key&&(n+=e.axis+"<br>"),n+=t.utils.format()(e.value)}),t.chart.svg().call(t._tip),t.chart.svg().append("g").selectAll("g").data(t._data).enter().append("g").attr("class","grouped").attr("transform",function(e){return"translate(0,"+t._scales.y(e[t._config.y])+" )"}).selectAll("rect").data(function(e){return t._config.groupBy.map(function(n){return{key:n,value:e[n],axis:e[t._config.y]}})}).enter().append("rect").attr("y",function(e){return t._scales.groupBy(e.key)}).attr("x",function(e){return e<0?t._scales.x(e.value):t._scales.x(0)}).attr("width",function(e){return Math.abs(t._scales.x(e.value)-t._scales.x(0))}).attr("height",t._scales.groupBy.bandwidth()).attr("fill",function(e){return t._scales.color(e.key)}).on("mouseover",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"onHover")}),t._tip.show(n,e.select(this).node()),t._config.hasOwnProperty("onmouseover")&&t._config.onmouseover.call(this,n,i)}).on("mouseout",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"default")}),t._tip.hide(),t._config.hasOwnProperty("onmouseout")&&t._config.onmouseout.call(this,n,i)}).on("click",function(e,n){t._config.hasOwnProperty("click")&&t._config.onclick.call(this,e,n)}),o.drawGroupLabels()},o.drawStackLabels=function(){var t=this,n=t.chart.svg().selectAll(".division"),i=0;n.each(function(n){var o=this,a=e.select(this).selectAll("rect").nodes();n.forEach(function(r){var s=o,c=r,l=a[i];i++,l.getBBox().height>35&&e.select(s).append("text").attr("class","dbox-label").attr("text-anchor","middle").attr("transform",function(){var e;return t._config.x?(e=t._scales.x.bandwidth(),"translate("+(t._scales.x(c.data[t._config.x])+e/2)+","+(t._scales.y(c[1])+20)+")"):(e=t._scales.y.bandwidth(),"translate("+(t._scales.x(c.data[1])-30)+","+(t._scales.y(c.data[t._config.y])+e/2)+")")}).text(function(){return c.data[n.key]?t.utils.format(null,!0)(c.data[n.key]):""})}),i=0})},o._drawStackByXAxis=function(){var t=this;t._tip.html(t._config.tip||function(e){var n="";for(var i in e.data)(e[1]-e[0]).toFixed(12)===Number(e.data[i]).toFixed(12)&&(n+=i+"<br>");return(n+=e.data[t._config.x])+"<br>"+t.utils.format()(e[1]-e[0])}),t.chart.svg().call(t._tip),t.chart.svg().append("g").selectAll("g").data(t._data).enter().append("g").attr("class","division").attr("fill",function(e){return t._scales.color(e.key)}).selectAll("rect").data(function(t){return t}).enter().append("rect").attr("y",function(e){return t._scales.y(e[1])}).attr("x",function(e){return t._scales.x(e.data[t._config.x])}).attr("width",function(){return t._scales.x.bandwidth()}).attr("height",function(e){return t._scales.y(e[0])-t._scales.y(e[1])}).on("mouseover",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"onHover")}),t._tip.show(n,e.select(this).node()),t._config.hasOwnProperty("onmouseover")&&t._config.onmouseover.call(this,n,i)}).on("mouseout",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"default")}),t._tip.hide(),t._config.hasOwnProperty("onmouseout")&&t._config.onmouseout.call(this,n,i)}).on("click",function(e,n){t._config.hasOwnProperty("click")&&t._config.onclick.call(this,e,n)}),o.drawStackLabels()},o._drawStackByYAxis=function(){var t=this;t._tip.html(t._config.tip||function(e){var n="";for(var i in e.data)(e[1]-e[0]).toFixed(12)===Number(e.data[i]).toFixed(12)&&(n+=i+"<br>");return(n+=e.data[t._config.y])+"<br>"+t.utils.format()(e[1]-e[0])}),t.chart.svg().call(t._tip),t.chart.svg().append("g").selectAll("g").data(t._data).enter().append("g").attr("class","division").attr("fill",function(e){return t._scales.color(e.key)}).selectAll("rect").data(function(t){return t}).enter().append("rect").attr("y",function(e){return t._scales.y(e.data[t._config.y])}).attr("x",function(e){return t._scales.x(e[0])}).attr("height",function(){return t._scales.y.bandwidth()}).attr("width",function(e){return t._scales.x(e[1])-t._scales.x(e[0])}).on("mouseover",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"onHover")}),t._tip.show(n,e.select(this).node()),t._config.hasOwnProperty("onmouseover")&&t._config.onmouseover.call(this,n,i)}).on("mouseout",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"default")}),t._tip.hide(),t._config.hasOwnProperty("onmouseout")&&t._config.onmouseout.call(this,n,i)}).on("click",function(e,n){t._config.hasOwnProperty("click")&&t._config.onclick.call(this,e,n)}),o.drawStackLabels()},o._setQuantile=function(t){var i=this,o=[],a=[];if(i._config.quantiles&&i._config.quantiles.predefinedQuantiles&&i._config.quantiles.predefinedQuantiles.length>0)return i._config.quantiles.predefinedQuantiles;if(t.forEach(function(t){o.push(+t[i._config.fill])}),o.sort(e.ascending),i._config&&i._config.quantiles&&i._config.quantiles.buckets)if(!0===i._config.quantiles.ignoreZeros){var r=n.dropWhile(o,function(t){return t<=0});a.push(o[0]),a.push(0);for(var s=1;s<=i._config.quantiles.buckets-1;s++)a.push(e.quantile(r,1*s/(i._config.quantiles.buckets-1)))}else{a.push(e.quantile(o,0));for(var c=1;c<=i._config.quantiles.buckets;c++)a.push(e.quantile(o,1*c/i._config.quantiles.buckets))}else a=[e.quantile(o,0),e.quantile(o,.2),e.quantile(o,.4),e.quantile(o,.6),e.quantile(o,.8),e.quantile(o,1)];return i._config.quantiles&&i._config.quantiles.buckets&&5===i._config.quantiles.buckets&&a[1]===a[2]&&a[2]===a[3]&&a[3]===a[4]&&a[4]===a[5]&&(a=[e.quantile(o,0),e.quantile(o,.2)]),a},o._getQuantileColor=function(t,e){var n=this,i=parseFloat(t);if(n._config&&n._config.bars.quantiles&&n._config.bars.quantiles.colors&&n._quantiles.length>2){if(n._config&&void 0!==n._config.bars.min&&void 0!==n._config.bars.max){if(i<n._config.bars.min||i>n._config.bars.max)return n._config.bars.quantiles.outOfRangeColor}else if(i<n._minMax[0]||i>n._minMax[1])return n._config.bars.quantiles.outOfRangeColor;if("default"==e){if(i<=n._quantiles[1])return n._config.bars.quantiles.colors[0];if(i<=n._quantiles[2])return n._config.bars.quantiles.colors[1];if(i<=n._quantiles[3])return n._config.bars.quantiles.colors[2];if(i<=n._quantiles[4])return n._config.quantiles.colors[3];if(i<=n._quantiles[5])return n._config.quantiles.colors[4]}if("onHover"==e&&n._config.hasOwnProperty("quantiles")&&n._config.quantiles.hasOwnProperty("colorsOnHover")){if(i<=n._quantiles[1])return n._config.quantiles.colorsOnHover[0];if(i<=n._quantiles[2])return n._config.quantiles.colorsOnHover[1];if(i<=n._quantiles[3])return n._config.quantiles.colorsOnHover[2];if(i<=n._quantiles[4])return n._config.quantiles.colorsOnHover[3];if(i<=n._quantiles[5])return n._config.quantiles.colorsOnHover[4]}}if(2==n._quantiles.length&&i<=n._quantiles[1])return n._config.quantiles.colors[0]},o.init(t),o}function r(t){function n(t){return t%1!=0?e.format(",.2f")(t):e.format(",.0f")(t)}function i(t){return t%1==0?e.format(",.0f")(t):t<1&&t>0?e.format(",.2f")(t):e.format(",.1f")(t)}function o(t){for(var n=t.split(" - "),i="",o=0;o<n.length;o++)n[o]%1==0?i+=e.format(",.0f")(n[o]):n[o]<1&&n[o]>0?i+=e.format(",.2f")(n[o]):i+=e.format(",.1f")(n[o]),0===o&&(i+=" - ");return i}function a(t){var e=Math.log(t)/Math.log(10)+1e-6;return Math.abs(e-Math.floor(e))<.6?n(t):""}function r(t){if("function"==typeof t)return t;if(Array.isArray(t)){var n={};return Array.isArray(u.settings.xSort)?u.settings.xSort.forEach(function(e,i){n[e]=t[i]}):Object.keys(u.groupObjs).sort(e.ascending).forEach(function(e,i){n[e]=t[i]}),function(t){return n[t]}}return"object"==(void 0===t?"undefined":y(t))?function(e){return t[e]}:e.scaleOrdinal(e.schemeCategory10)}function s(t,e){var n={left:null,right:null,middle:null},i=u.xScale.bandwidth()*(t/100),o=(u.xScale.bandwidth()-i)/2,a=u.xScale(e);return n.middle=u.xScale.bandwidth()/2+a,n.left=o+a,n.right=n.left+i,n}function c(t,e){return!0!==t||0==e?0:Math.floor(Math.random()*e)-e/2}function l(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function f(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",r=i;return r+=o?"<br>"+o.toLocaleString()+'<br><hr style="height: 1px; background-color: #ADADAE; border: none; margin: 0.5em;">':"",r+=t,r+=a?"":"<br>Max: "+n(e.max,.1),r+=a?"":"<br>Q3: "+n(e.quartile3),r+=a?"mean"===a?"<br>Media: "+n(e.mean):"":"<br>Media: "+n(e.mean),r+=a?"median"===a?"<br>Mediana: "+n(e.median):"":"<br>Mediana: "+n(e.median),r+=a?"":"<br>Q1: "+n(e.quartile1),r+=a?"":"<br>Min: "+n(e.min),function(){u.objs.tooltip.transition().duration(200).style("opacity",.8),u.objs.tooltip.html(r)}}var u={};u.settings={data:null,id:null,idName:null,events:null,xName:null,xSort:null,yName:null,selector:null,axisLables:null,yTicks:1,scale:"linear",chartSize:{width:800,height:400},margin:{top:15,right:60,bottom:40,left:50},constrainExtremes:!1,color:e.scaleOrdinal(e.schemeCategory10)};for(var g in t)u.settings[g]=t[g];return u.yFormatter=i,u.xFormatter=o,u.data=u.settings.data,u.groupObjs={},u.objs={mainDiv:null,chartDiv:null,g:null,xAxis:null,yAxis:null},u.colorFunct=null,function(){var t,n=null,i=null,o=null,a=null;for(t=0;t<u.data.length;t++)n=u.data[t][u.settings.xName],i=u.data[t][u.settings.yName],o=u.settings.id?u.data[t][u.settings.id]:null,a=u.settings.idName?u.data[t][u.settings.idName]:null,u.groupObjs.hasOwnProperty(n)?u.settings.id?u.groupObjs[n].valuesInfo.push({value:i,id:o,idName:a}):u.groupObjs[n].values.push(i):u.settings.id?(u.groupObjs[n]={},u.groupObjs[n].valuesInfo=[{value:i,id:o,idName:a}]):(u.groupObjs[n]={},u.groupObjs[n].values=[i]);for(var r in u.groupObjs){if(u.settings.id){u.groupObjs[r].values=[];for(var s=0;s<u.groupObjs[r].valuesInfo.length;s++)u.groupObjs[r].values.push(u.groupObjs[r].valuesInfo[s].value);u.groupObjs[r].valuesInfo.sort(function(t,n){return e.ascending(t.value,n.value)})}u.groupObjs[r].values.sort(e.ascending),u.groupObjs[r].metrics={},u.groupObjs[r].metrics=function(t){var n={max:null,upperOuterFence:null,upperInnerFence:null,quartile3:null,median:null,mean:null,iqr:null,quartile1:null,lowerInnerFence:null,lowerOuterFence:null,min:null};n.min=e.min(t),n.quartile1=e.quantile(t,.25),n.median=e.median(t),n.mean=e.mean(t),n.quartile3=e.quantile(t,.75),n.max=e.max(t),n.iqr=n.quartile3-n.quartile1;for(var i=n.quartile1-1.5*n.iqr,o=n.quartile3+1.5*n.iqr,a=0;a<=t.length;a++)if(!(t[a]<i))if(!n.lowerInnerFence&&t[a]>=i)n.lowerInnerFence=t[a];else if(t[a]>o){n.upperInnerFence=t[a-1];break}return n.lowerOuterFence=n.quartile1-3*n.iqr,n.upperOuterFence=n.quartile3+3*n.iqr,n.lowerInnerFence||(n.lowerInnerFence=n.min),n.upperInnerFence||(n.upperInnerFence=n.max),n}(u.groupObjs[r].values)}}(),function(){var t="";if(u.margin=u.settings.margin,u.divWidth=u.settings.chartSize.width,u.divHeight=u.settings.chartSize.height,u.width=u.divWidth-u.margin.left-u.margin.right,u.height=u.divHeight-u.margin.top-u.margin.bottom,u.settings.axisLabels?(u.xAxisLable=u.settings.axisLabels.xAxis,u.yAxisLable=u.settings.axisLabels.yAxis):(u.xAxisLable=u.settings.xName,u.yAxisLable=u.settings.yName),"log"===u.settings.scale?(u.yScale=e.scaleLog(),u.yFormatter=a):u.yScale=e.scaleLinear(),!0===u.settings.constrainExtremes){var n=[];for(var i in u.groupObjs)n.push(u.groupObjs[i].metrics.lowerInnerFence),n.push(u.groupObjs[i].metrics.upperInnerFence);u.range=e.extent(n)}else u.range=e.extent(u.data,function(t){return t[u.settings.yName]});u.colorFunct=r(u.settings.colors),u.yScale.range([u.height,0]).domain(u.range).nice().clamp(!0),t=null===u.settings.xSort?Object.keys(u.groupObjs):Array.isArray(u.settings.xSort)?u.settings.xSort:Object.keys(u.groupObjs).sort(e.ascending),u.xScale=e.scaleBand().domain(t).rangeRound([0,u.width]),u.objs.yAxis=e.axisLeft().scale(u.yScale).tickFormat(u.yFormatter).tickSizeOuter(0).tickSizeInner(-u.width+(u.margin.right+u.margin.left)),u.objs.xAxis=e.axisBottom().scale(u.xScale).tickSizeOuter(0).tickSize(5)}(),u.update=function(){return u.width=parseInt(u.objs.chartDiv.style("width"),10)-(u.margin.left+u.margin.right),u.height=parseInt(u.objs.chartDiv.style("height"),10)-(u.margin.top+u.margin.bottom),u.xScale.rangeRound([0,u.width]),u.yScale.range([u.height,0]),u.violinPlots&&1==u.violinPlots.options.show&&null!=u.violinPlots.options._yDomainVP?u.yScale.domain(u.violinPlots.options._yDomainVP).nice().clamp(!0):u.yScale.domain(u.range).nice().clamp(!0),u.objs.g.select(".x.axis").attr("transform","translate(0,"+u.height+")").call(u.objs.xAxis).selectAll(".tick text").attr("y",5).attr("x",-5).attr("transform","rotate(-40)").style("text-anchor","end"),u.objs.g.select(".x.axis .label").attr("x",u.width/2),u.objs.g.select(".y.axis").call(u.objs.yAxis.tickSizeInner(-u.width)),u.objs.g.select(".y.axis .label").attr("x",-u.height/2),u.objs.chartDiv.select("svg").attr("width",u.width+(u.margin.left+u.margin.right)).attr("height",u.height+(u.margin.top+u.margin.bottom)),u},function(){u.objs.mainDiv=e.select(u.settings.selector).style("width",u.divWidth+"px").style("height",u.divHeight+"px"),u.objs.mainDiv.append("div").attr("class","inner-wrapper").style("padding-bottom","5%").style("height",u.divHeight+"px").append("div").attr("class","outer-box").append("div").attr("class","inner-box"),u.selector=u.settings.selector+" .inner-box",u.objs.chartDiv=e.select(u.selector),e.select(window).on("resize."+u.selector,u.update),u.objs.g=u.objs.chartDiv.append("svg").attr("class","chart-area").attr("width",u.width+(u.margin.left+u.margin.right)).attr("height",u.height+(u.margin.top+u.margin.bottom)).append("g").attr("transform","translate("+u.margin.left+","+u.margin.top+")"),u.objs.axes=u.objs.g.append("g").attr("class","axis"),u.objs.axes.append("g").attr("class","x axis").attr("transform","translate(0,"+u.height+")").call(u.objs.xAxis).append("text").attr("class","label").attr("y",u.margin.bottom-20).attr("x",-u.width/2).attr("dy",".71em").attr("fill","#fff").style("text-anchor","middle").text(u.xAxisLable),u.objs.axes.append("g").attr("class","y axis").call(u.objs.yAxis).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",.9*-u.margin.left).attr("x",-u.height/2).attr("dy",".71em").attr("fill","#fff").style("text-anchor","middle").text(u.yAxisLable),u.objs.tooltip=u.objs.mainDiv.append("div").attr("class","tooltip").style("display","none");for(var t in u.groupObjs)u.groupObjs[t].g=u.objs.g.append("g").attr("class","group");u.update()}(),u.renderViolinPlot=function(t){function n(t,n){return function(i){return n.map(function(n){return{x:n,y:e.mean(i,function(e){return t(n-e)})}})}}function i(t){return function(e){return Math.abs(e/=t)<=1?.75*(1-e*e)/t:0}}function o(t,n){return function(i){return e.mean(n,function(e){return t(i-e)})}}u.violinPlots={};var a={show:!0,showViolinPlot:!0,resolution:100,bandwidth:20,width:50,curve:e.curveCardinal,clamp:1,colors:u.colorFunct,_yDomainVP:null};u.violinPlots.options=l(a);for(var c in t)u.violinPlots.options[c]=t[c];var f=u.violinPlots.options;for(var g in u.groupObjs)u.groupObjs[g].violin={},u.groupObjs[g].violin.objs={};return u.violinPlots.change=function(t){if(t)for(var e in t)f[e]=t[e];for(var n in u.groupObjs)u.groupObjs[n].violin.objs.g.remove();u.violinPlots.prepareViolin(),u.violinPlots.update()},u.violinPlots.reset=function(){u.violinPlots.change(a)},u.violinPlots.show=function(t){void 0!==t?(t.show=!0,t.reset&&u.violinPlots.reset()):t={show:!0},u.violinPlots.change(t)},u.violinPlots.hide=function(t){void 0!==t?(t.show=!1,t.reset&&u.violinPlots.reset()):t={show:!1},u.violinPlots.change(t)},u.violinPlots.update=function(){var t,a;for(t in u.groupObjs){a=u.groupObjs[t].violin;var r=u.yScale.copy();a.kde=n(i(f.bandwidth),r.ticks(f.resolution)),a.kdedata=a.kde(u.groupObjs[t].values);var c=u.groupObjs[t].metrics.max,l=u.groupObjs[t].metrics.min;if(0==f.clamp||-1==f.clamp){if(c=e.min(a.kdedata.filter(function(e){return e.x>u.groupObjs[t].metrics.max&&0==e.y}),function(t){return t.x}),l=e.max(a.kdedata.filter(function(e){return e.x<u.groupObjs[t].metrics.min&&0==e.y}),function(t){return t.x}),-1==f.clamp){if(kdeTester=o(i(f.bandwidth),u.groupObjs[t].values),!c){for(var g=kdeTester(u.groupObjs[t].metrics.max),d=u.groupObjs[t].metrics.max,_=25;_>0&&0!=g;)g=kdeTester(d),d+=1,_-=1;c=d}if(!l){
for(var p=kdeTester(u.groupObjs[t].metrics.min),x=u.groupObjs[t].metrics.min,_=25;_>0&&0!=p;)p=kdeTester(x),x-=1,_-=1;l=x}}f._yDomainVP||(f._yDomainVP=u.range.slice(0)),l&&l<f._yDomainVP[0]&&(f._yDomainVP[0]=l),c&&c>f._yDomainVP[1]&&(f._yDomainVP[1]=c)}f.showViolinPlot&&(u.update(),r=u.yScale.copy(),a.kde=n(i(f.bandwidth),r.ticks(f.resolution)),a.kdedata=a.kde(u.groupObjs[t].values)),a.kdedata=a.kdedata.filter(function(t){return!l||t.x>=l}).filter(function(t){return!c||t.x<=c})}for(t in u.groupObjs){a=u.groupObjs[t].violin;var h=s(f.width,t),y=(h.right-h.left)/2,m=e.scaleLinear().range([y,0]).domain([0,e.max(a.kdedata,function(t){return t.y})]).clamp(!0),v=e.area().curve(f.curve).x(function(t){return r(t.x)}).y0(y).y1(function(t){return m(t.y)}),b=e.line().curve(f.curve).x(function(t){return r(t.x)}).y(function(t){return m(t.y)});a.objs.left.area&&(a.objs.left.area.datum(a.kdedata).attr("d",v),a.objs.left.line.datum(a.kdedata).attr("d",b),a.objs.right.area.datum(a.kdedata).attr("d",v),a.objs.right.line.datum(a.kdedata).attr("d",b)),a.objs.left.g.attr("transform","rotate(90,0,0)   translate(0,-"+h.left+")  scale(1,-1)"),a.objs.right.g.attr("transform","rotate(90,0,0)  translate(0,-"+h.right+")")}},u.violinPlots.prepareViolin=function(){var t,e;if(f.colors?u.violinPlots.color=r(f.colors):u.violinPlots.color=u.colorFunct,0!=f.show)for(t in u.groupObjs)e=u.groupObjs[t].violin,e.objs.g=u.groupObjs[t].g.append("g").attr("class","violin-plot"),e.objs.left={area:null,line:null,g:null},e.objs.right={area:null,line:null,g:null},e.objs.left.g=e.objs.g.append("g"),e.objs.right.g=e.objs.g.append("g"),!1!==f.showViolinPlot&&(e.objs.left.area=e.objs.left.g.append("path").attr("class","area").style("fill",u.violinPlots.color(t)),e.objs.right.area=e.objs.right.g.append("path").attr("class","area").style("fill",u.violinPlots.color(t)),e.objs.left.line=e.objs.left.g.append("path").attr("class","line").attr("fill","none").style("stroke",u.violinPlots.color(t)),e.objs.right.line=e.objs.right.g.append("path").attr("class","line").attr("fill","none").style("stroke",u.violinPlots.color(t)))},u.violinPlots.prepareViolin(),e.select(window).on("resize."+u.selector+".violinPlot",u.violinPlots.update),u.violinPlots.update(),u},u.renderBoxPlot=function(t){u.boxPlots={};var n={show:!0,showBox:!0,showWhiskers:!0,showMedian:!0,showMean:!1,medianCSize:3.5,showOutliers:!0,boxWidth:30,lineWidth:null,scatterOutliers:!1,outlierCSize:2.5,colors:u.colorFunct};u.boxPlots.options=l(n);for(var i in t)u.boxPlots.options[i]=t[i];var o=u.boxPlots.options;for(var a in u.groupObjs)u.groupObjs[a].boxPlot={},u.groupObjs[a].boxPlot.objs={};return function(){for(var t in u.groupObjs)!function(t){var e,n,i=[],o=[];for(n=0;n<=t.values.length;n++)e={value:t.values[n]},e.value<t.metrics.lowerInnerFence?e.value<t.metrics.lowerOuterFence?i.push(e):o.push(e):e.value>t.metrics.upperInnerFence&&(e.value>t.metrics.upperOuterFence?i.push(e):o.push(e));t.boxPlot.objs.outliers=o,t.boxPlot.objs.extremes=i}(u.groupObjs[t])}(),u.boxPlots.change=function(t){if(t)for(var e in t)o[e]=t[e];for(var n in u.groupObjs)u.groupObjs[n].boxPlot.objs.g.remove();u.boxPlots.prepareBoxPlot(),u.boxPlots.update()},u.boxPlots.reset=function(){u.boxPlots.change(n)},u.boxPlots.show=function(t){void 0!==t?(t.show=!0,t.reset&&u.boxPlots.reset()):t={show:!0},u.boxPlots.change(t)},u.boxPlots.hide=function(t){void 0!==t?(t.show=!1,t.reset&&u.boxPlots.reset()):t={show:!1},u.boxPlots.change(t)},u.boxPlots.update=function(){var t,e;for(t in u.groupObjs){e=u.groupObjs[t].boxPlot;var n=s(o.boxWidth,t),i=n.right-n.left,a={};for(var r in u.groupObjs[t].metrics)a[r]=null,a[r]=u.yScale(u.groupObjs[t].metrics[r]);e.objs.box&&e.objs.box.attr("x",n.left).attr("width",i).attr("y",a.quartile3).attr("rx",1).attr("ry",1).attr("height",-a.quartile3+a.quartile1);var l=null;l=o.lineWidth?s(o.lineWidth,t):n,e.objs.upperWhisker&&(e.objs.upperWhisker.fence.attr("x1",l.left).attr("x2",l.right).attr("y1",a.upperInnerFence).attr("y2",a.upperInnerFence),e.objs.upperWhisker.line.attr("x1",l.middle).attr("x2",l.middle).attr("y1",a.quartile3).attr("y2",a.upperInnerFence),e.objs.lowerWhisker.fence.attr("x1",l.left).attr("x2",l.right).attr("y1",a.lowerInnerFence).attr("y2",a.lowerInnerFence),e.objs.lowerWhisker.line.attr("x1",l.middle).attr("x2",l.middle).attr("y1",a.quartile1).attr("y2",a.lowerInnerFence)),e.objs.median&&(e.objs.median.line.attr("x1",l.left).attr("x2",l.right).attr("y1",a.median).attr("y2",a.median),e.objs.median.circle.attr("cx",l.middle).attr("cy",a.median)),e.objs.mean&&(e.objs.mean.line.attr("x1",l.left).attr("x2",l.right).attr("y1",a.mean).attr("y2",a.mean),e.objs.mean.circle.attr("cx",l.middle).attr("cy",a.mean));var f;if(e.objs.outliers)for(f in e.objs.outliers)e.objs.outliers[f].point.attr("cx",n.middle+c(o.scatterOutliers,i)).attr("cy",u.yScale(e.objs.outliers[f].value));if(e.objs.extremes)for(f in e.objs.extremes)e.objs.extremes[f].point.attr("cx",n.middle+c(o.scatterOutliers,i)).attr("cy",u.yScale(e.objs.extremes[f].value))}},u.boxPlots.prepareBoxPlot=function(){var t,n;if(o.colors?u.boxPlots.colorFunct=r(o.colors):u.boxPlots.colorFunct=u.colorFunct,0!=o.show)for(t in u.groupObjs)if(n=u.groupObjs[t].boxPlot,n.objs.g=u.groupObjs[t].g.append("g").attr("class","box-plot"),o.showBox&&(n.objs.box=n.objs.g.append("rect").attr("class","box").style("fill",u.boxPlots.colorFunct(t)).style("stroke",u.boxPlots.colorFunct(t))),o.showMedian&&(n.objs.median={line:null,circle:null},n.objs.median.line=n.objs.g.append("line").attr("class","median"),n.objs.median.circle=n.objs.g.append("circle").attr("class","median").attr("r",o.medianCSize).style("fill",u.boxPlots.colorFunct(t)).on("mouseover",function(){u.objs.tooltip.style("display",null).style("left",e.event.pageX+"px").style("top",e.event.pageY-28+"px")}).on("mouseout",function(){u.objs.tooltip.style("display","none")}).on("mousemove",f(t,u.groupObjs[t].metrics,"","","median"))),o.showMean&&(n.objs.mean={line:null,circle:null},n.objs.mean.line=n.objs.g.append("line").attr("class","mean"),n.objs.mean.circle=n.objs.g.append("circle").attr("class","mean").attr("r",o.medianCSize).style("fill",u.boxPlots.colorFunct(t)).on("mouseover",function(){u.objs.tooltip.style("display",null).style("left",e.event.pageX+"px").style("top",e.event.pageY-28+"px")}).on("mouseout",function(){u.objs.tooltip.style("display","none")}).on("mousemove",f(t,u.groupObjs[t].metrics,"","","mean"))),o.showWhiskers&&(n.objs.upperWhisker={fence:null,line:null},n.objs.lowerWhisker={fence:null,line:null},n.objs.upperWhisker.fence=n.objs.g.append("line").attr("class","upper whisker").style("stroke",u.boxPlots.colorFunct(t)),n.objs.upperWhisker.line=n.objs.g.append("line").attr("class","upper whisker").style("stroke",u.boxPlots.colorFunct(t)),n.objs.lowerWhisker.fence=n.objs.g.append("line").attr("class","lower whisker").style("stroke",u.boxPlots.colorFunct(t)),n.objs.lowerWhisker.line=n.objs.g.append("line").attr("class","lower whisker").style("stroke",u.boxPlots.colorFunct(t))),o.showOutliers){n.objs.outliers||calcAllOutliers();var i;if(n.objs.outliers.length){var a=n.objs.g.append("g").attr("class","boxplot outliers");for(i in n.objs.outliers)n.objs.outliers[i].point=a.append("circle").attr("class","outlier").attr("r",o.outlierCSize).style("fill",u.boxPlots.colorFunct(t))}if(n.objs.extremes.length){var s=n.objs.g.append("g").attr("class","boxplot extremes");for(i in n.objs.extremes)n.objs.extremes[i].point=s.append("circle").attr("class","extreme").attr("r",o.outlierCSize).style("stroke",u.boxPlots.colorFunct(t))}}},u.boxPlots.prepareBoxPlot(),e.select(window).on("resize."+u.selector+".boxPlot",u.boxPlots.update),u.boxPlots.update(),u},u.renderNotchBoxes=function(t){function n(t,e){var n=[];return n="box"==a.notchStyle?[[e.boxLeft,u.yScale(t.metrics.quartile1)],[e.boxLeft,u.yScale(t.metrics.lowerNotch)],[e.medianLeft,u.yScale(t.metrics.lowerNotch)],[e.medianLeft,u.yScale(t.metrics.median)],[e.medianLeft,u.yScale(t.metrics.upperNotch)],[e.boxLeft,u.yScale(t.metrics.upperNotch)],[e.boxLeft,u.yScale(t.metrics.quartile3)],[e.boxRight,u.yScale(t.metrics.quartile3)],[e.boxRight,u.yScale(t.metrics.upperNotch)],[e.medianRight,u.yScale(t.metrics.upperNotch)],[e.medianRight,u.yScale(t.metrics.median)],[e.medianRight,u.yScale(t.metrics.lowerNotch)],[e.boxRight,u.yScale(t.metrics.lowerNotch)],[e.boxRight,u.yScale(t.metrics.quartile1)]]:[[e.boxLeft,u.yScale(t.metrics.quartile1)],[e.boxLeft,u.yScale(t.metrics.lowerNotch)],[e.medianLeft,u.yScale(t.metrics.median)],[e.boxLeft,u.yScale(t.metrics.upperNotch)],[e.boxLeft,u.yScale(t.metrics.quartile3)],[e.boxRight,u.yScale(t.metrics.quartile3)],[e.boxRight,u.yScale(t.metrics.upperNotch)],[e.medianRight,u.yScale(t.metrics.median)],[e.boxRight,u.yScale(t.metrics.lowerNotch)],[e.boxRight,u.yScale(t.metrics.quartile1)]],n.map(function(t){return[t[0],t[1]].join(",")}).join(" ")}u.notchBoxes={};var i={show:!0,showNotchBox:!0,showLines:!1,boxWidth:35,medianWidth:20,lineWidth:50,notchStyle:null,colors:null};u.notchBoxes.options=l(i);for(var o in t)u.notchBoxes.options[o]=t[o];var a=u.notchBoxes.options;for(var c in u.groupObjs)u.groupObjs[c].notchBox={},u.groupObjs[c].notchBox.objs={};return function(){var t,e;for(var n in u.groupObjs)t=u.groupObjs[n],e=t.metrics.iqr/Math.sqrt(t.values.length)*1.57,t.metrics.upperNotch=t.metrics.median+e,t.metrics.lowerNotch=t.metrics.median-e}(),u.notchBoxes.change=function(t){if(t)for(var e in t)a[e]=t[e];for(var n in u.groupObjs)u.groupObjs[n].notchBox.objs.g.remove();u.notchBoxes.prepareNotchBoxes(),u.notchBoxes.update()},u.notchBoxes.reset=function(){u.notchBoxes.change(i)},u.notchBoxes.show=function(t){void 0!==t?(t.show=!0,t.reset&&u.notchBoxes.reset()):t={show:!0},u.notchBoxes.change(t)},u.notchBoxes.hide=function(t){void 0!==t?(t.show=!1,t.reset&&u.notchBoxes.reset()):t={show:!1},u.notchBoxes.change(t)},u.notchBoxes.update=function(){var t,e;for(t in u.groupObjs){e=u.groupObjs[t];var i=s(a.boxWidth,t),o=s(a.medianWidth,t),r={boxLeft:i.left,boxRight:i.right,middle:i.middle,medianLeft:o.left,medianRight:o.right};if(e.notchBox.objs.notch&&e.notchBox.objs.notch.attr("points",n(e,r)),e.notchBox.objs.upperLine){var c=null;c=a.lineWidth?s(a.lineWidth,t):objBounds;var l={upper:u.yScale(e.metrics.upperNotch),lower:u.yScale(e.metrics.lowerNotch)};e.notchBox.objs.upperLine.attr("x1",c.left).attr("x2",c.right).attr("y1",l.upper).attr("y2",l.upper),e.notchBox.objs.lowerLine.attr("x1",c.left).attr("x2",c.right).attr("y1",l.lower).attr("y2",l.lower)}}},u.notchBoxes.prepareNotchBoxes=function(){var t,e;if(a&&a.colors?u.notchBoxes.colorFunct=r(a.colors):u.notchBoxes.colorFunct=u.colorFunct,0!=a.show)for(t in u.groupObjs)e=u.groupObjs[t].notchBox,e.objs.g=u.groupObjs[t].g.append("g").attr("class","notch-plot"),a.showNotchBox&&(e.objs.notch=e.objs.g.append("polygon").attr("class","notch").style("fill",u.notchBoxes.colorFunct(t)).style("stroke",u.notchBoxes.colorFunct(t))),a.showLines&&(e.objs.upperLine=e.objs.g.append("line").attr("class","upper confidence line").style("stroke",u.notchBoxes.colorFunct(t)),e.objs.lowerLine=e.objs.g.append("line").attr("class","lower confidence line").style("stroke",u.notchBoxes.colorFunct(t)))},u.notchBoxes.prepareNotchBoxes(),e.select(window).on("resize."+u.selector+".notchBox",u.notchBoxes.update),u.notchBoxes.update(),u},u.renderDataPlots=function(t){u.dataPlots={};var n={show:!0,showPlot:!1,plotType:"none",pointSize:7,showLines:!1,showBeanLines:!1,beanWidth:20,colors:null};u.dataPlots.options=l(n);for(var i in t)u.dataPlots.options[i]=t[i];var o=u.dataPlots.options;for(var a in u.groupObjs)u.groupObjs[a].dataPlots={},u.groupObjs[a].dataPlots.objs={};return u.dataPlots.objs={},u.dataPlots.change=function(t){if(t)for(var e in t)o[e]=t[e];u.dataPlots.objs.g.remove();for(var n in u.groupObjs)u.groupObjs[n].dataPlots.objs.g.remove();u.dataPlots.preparePlots(),u.dataPlots.update()},u.dataPlots.reset=function(){u.dataPlots.change(n)},u.dataPlots.show=function(t){void 0!==t?(t.show=!0,t.reset&&u.dataPlots.reset()):t={show:!0},u.dataPlots.change(t)},u.dataPlots.hide=function(t){void 0!==t?(t.show=!1,t.reset&&u.dataPlots.reset()):t={show:!1},u.dataPlots.change(t)},u.dataPlots.update=function(){var t,n,i;if(u.dataPlots.objs.g){var a=u.xScale.bandwidth()/2;for(var r in u.dataPlots.objs.lines)u.dataPlots.objs.lines[r].line.x(function(t){return u.xScale(t.x)+a}),u.dataPlots.objs.lines[r].g.datum(u.dataPlots.objs.lines[r].values).attr("d",u.dataPlots.objs.lines[r].line)}for(t in u.groupObjs){if(n=u.groupObjs[t],i=n.dataPlots,i.objs.points)if("beeswarm"==o.plotType){for(var l=s(100,t),f=u.yScale.copy().range([Math.floor(u.yScale.range()[0]/o.pointSize),0]).interpolate(e.interpolateRound).domain(u.yScale.domain()),g=Math.floor(u.xScale.bandwidth()/o.pointSize),d={},_=null,p=0;p<n.values.length;p++)_=f(n.values[p]),!0!==d.hasOwnProperty(_)&&(d[_]=[]),d[_].push(i.objs.points.pts[p].attr("cx",l.middle).attr("cy",f(n.values[p])*o.pointSize));var x=Math.min(l.right-o.pointSize);for(var h in d){var y=l.left+Math.max((g-d[h].length)/2,0)*o.pointSize,m=0;for(p in d[h])d[h][p].attr("cx",Math.min(y+m*o.pointSize,x)+o.pointSize/2),m++}}else{var v=null,b=0,A=0;"scatter"!=o.plotType&&"number"!=typeof o.plotType||(b="number"==typeof o.plotType?o.plotType:20),v=s(b,t),A=v.right-v.left;for(var p=0;p<n.values.length;p++)i.objs.points.pts[p].attr("cx",v.middle+c(!0,A)).attr("cy",u.yScale(n.values[p]))}if(i.objs.bean)for(var w=s(o.beanWidth,t),p=0;p<n.values.length;p++)i.objs.bean.lines[p].attr("x1",w.left).attr("x2",w.right).attr("y1",u.yScale(n.values[p])).attr("y2",u.yScale(n.values[p]))}},u.dataPlots.preparePlots=function(){var t,n;if(o&&o.colors?u.dataPlots.colorFunct=r(o.colors):u.dataPlots.colorFunct=u.colorFunct,0!=o.show){if(u.dataPlots.objs.g=u.objs.g.append("g").attr("class","metrics-lines"),o.showLines&&o.showLines.length>0){u.dataPlots.objs.lines={};var i;for(var a in o.showLines){i=o.showLines[a],u.dataPlots.objs.lines[i]={},u.dataPlots.objs.lines[i].values=[];for(var s in u.groupObjs)u.dataPlots.objs.lines[i].values.push({x:s,y:u.groupObjs[s].metrics[i]});u.dataPlots.objs.lines[i].line=e.line().curve(e.curveCardinal).y(function(t){return u.yScale(t.y)}),u.dataPlots.objs.lines[i].g=u.dataPlots.objs.g.append("path").attr("class","line "+i).attr("data-metric",i).style("fill","none").style("stroke",u.colorFunct(i))}}for(t in u.groupObjs){if(n=u.groupObjs[t].dataPlots,n.objs.g=u.groupObjs[t].g.append("g").attr("class","data-plot"),o.showPlot){n.objs.points={g:null,pts:[]},n.objs.points.g=n.objs.g.append("g").attr("class","points-plot");for(var c=0;c<u.groupObjs[t].values.length;c++)!function(){var i=u.groupObjs[t].values[c],a=u.groupObjs[t].valuesInfo[c];n.objs.points.pts.push(n.objs.points.g.append("circle").attr("class","point").attr("class",function(){return!!u.settings.id&&u.settings.id?"distro-"+a.id:""}).attr("r",o.pointSize/2).style("fill",u.dataPlots.colorFunct(t)).style("fill-opacity",.6).style("stroke",u.dataPlots.colorFunct(t)).style("stroke-width","2px").on("mouseover",function(){u.objs.tooltip.style("display",null).style("left",e.event.pageX+"px").style("top",e.event.pageY-28+"px")}).on("mouseout",function(){u.objs.tooltip.style("display","none")}).on("mousemove",f(t,u.groupObjs[t].metrics,a.idName,i)).on("click",function(){u.settings.events.onClickElement&&u.settings.events.onClickElement.call(this,a)}))}()}if(o.showBeanLines){n.objs.bean={g:null,lines:[]},n.objs.bean.g=n.objs.g.append("g").attr("class","bean-plot");for(var c=0;c<u.groupObjs[t].values.length;c++)n.objs.bean.lines.push(n.objs.bean.g.append("line").attr("class","bean line").style("stroke-width","1").style("stroke",u.dataPlots.colorFunct(t)))}}}},u.dataPlots.preparePlots(),e.select(window).on("resize."+u.selector+".dataPlot",u.dataPlots.update),u.dataPlots.update(),u},u}function s(t,n){var i=Object.create(n);return i.init=function(t){var e=this;e._config=t||{},e._data=[],e._scales={},e._axes={},e._tip=e.utils.d3.tip().attr("class","d3-tip").html(e._config.tip?e._config.tip:function(t){var n="";return n+=t.y?"<span>"+(Number.isNaN(+t.y)?t.y:e.utils.format(e._config.yAxis)(t.y))+"</span></br>":""})},i.type=function(t){var e=this;return e._config.type=t,e},i.x=function(t){var e=this;return e._config.x=t,e},i.y=function(t){var e=this;return e._config.y=t,e},i.sortBy=function(t){var e=this;return e._config.sortBy=t,e},i.fill=function(t){var e=this;return e._config.fill=t,e},i.id=function(t){var e=this;return e._config.id=t,e},i.colors=function(t){var e=this;return Array.isArray(t)?e._config.colors=t:e._scales.color=t,e},i.tip=function(t){var e=this;return e._config.tip=t,e._tip.html(e._config.tip),e},i.data=function(t){var e=this;return e._data=[],t.forEach(function(t){t.x=t[e._config.x],t.y=+t[e._config.y],t.color=e._config.fill?t[e._config.fill]:"red",delete t[e._config.x],delete t[e._config.y],e._config.fill&&delete t[e._config.x],e._data.push(t)}),e},i.scales=function(){return this},i.draw=function(){var t=this;t.chart.fullSvg().remove();var n=r({chart:t.chart,data:t._data,id:t._config.id,idName:t._config.idName,events:t._config.events,xName:"x",xSort:"object"===y(t._config.sortBy)&&t._config.sortBy.x?t._config.sortBy.x:null,yName:"y",axisLabels:{xAxis:t._config.axisLabels.xAxis,yAxis:t._config.axisLabels.yAxis},selector:"#distro",colors:["#fff5ca","#fbc43a","#5cbd00","#084c1f"],chartSize:{height:t._config.size.height,width:t._config.size.width},margin:{top:t._config.size.margin.top,right:t._config.size.margin.right,bottom:t._config.size.margin.bottom,left:t._config.size.margin.left},constrainExtremes:!0});return t.chart.config.styles&&e.select("#distro .tooltip").style("background-color",t.chart.style.tooltip.backgroundColor).style("line-height",1).style("font-weight",t.chart.style.tooltip.text.fontWeight).style("font-size",t.chart.style.tooltip.text.fontSize).style("color",t.chart.style.tooltip.text.textColor).style("font-family",t.chart.style.tooltip.text.fontFamily).style("background-color",t.chart.style.tooltip.backgroundColor).style("padding",t.chart.style.tooltip.text.padding).style("border",t.chart.style.tooltip.border.width+" solid "+t.chart.style.tooltip.border.color).style("border-radius",t.chart.style.tooltip.border.radius),n.renderBoxPlot(),n.renderDataPlots(),n.renderNotchBoxes({showNotchBox:!1}),n.renderViolinPlot({showViolinPlot:!1}),n.boxPlots.show({reset:!0,showWhiskers:!1,showOutliers:!1,showMean:!0,showMedian:!0,showBox:!1}),n.dataPlots.change({showPlot:!0}),n.violinPlots.show({reset:!0,clamp:0,width:100}),"violin"===t._config.type&&(n.violinPlots.show({reset:!0,clamp:1,width:50}),n.boxPlots.show({reset:!0,showWhiskers:!1,showOutliers:!1,boxWidth:10,lineWidth:15,colors:["#555"]}),n.notchBoxes.hide(),n.dataPlots.change({showPlot:!1,showBeanLines:!1})),"scatter"===t._config.type&&(n.violinPlots.hide(),n.dataPlots.show({showPlot:!0,plotType:40,showBeanLines:!1,colors:null}),n.notchBoxes.hide()),t},i.select=function(t){return e.select("#distro .distro-"+t)},i.selectAll=function(t){return e.selectAll("#distro "+t)},i.init(t),i}function c(t,n){var i=Object.create(n);return i.init=function(t){var e=this;e._config=t||{},e._config.size.legendTranslate||(e._config.size.legendTranslate=100),e._data=[],e._scales={},e._axes={},e._legendElementWidth=e._gridWidth,e._tip=e.utils.d3.tip().attr("class","d3-tip "+(e._config.tooltip&&e._config.tooltip.classed?e._config.tooltip.classed:"")).direction("n").html(e._config.tip||function(t){var n=t.x;return t.x!==t.y&&(n+="<br>"+t.y),n+="<br>"+e.utils.format()(t.value)})},i.x=function(t){var e=this;return e._config.x=t,e},i.y=function(t){var e=this;return e._config.y=t,e},i.fill=function(t){var e=this;return e._config.fill=t,e},i.colors=function(t){var e=this;return e._config.colors=t,e},i.colorLegend=function(t){var e=this;return e._config.legendTitle=t,e},i.borderRadius=function(t){var e=this;return e._config.borderRadius=t,e},i.sortBy=function(t){var e=this;return e._config.sortBy=t,e},i.tip=function(t){var e=this;return e._config.tip=t,e._tip.html(e._config.tip),e},i.data=function(t){var n=this,i=n.utils.sortAscending,o=n.utils.sortAscending;return"string"==typeof n._config.sortBy&&n._config.hasOwnProperty("sortBy")&&"desc"===n._config.sortBy&&(i=n.utils.sortDescending),"object"===y(n._config.sortBy)&&(n._config.hasOwnProperty("sortBy")&&n._config.sortBy.hasOwnProperty("x")&&"desc"===n._config.sortBy.x&&(i=n.utils.sortDescending),n._config.hasOwnProperty("sortBy")&&n._config.sortBy.hasOwnProperty("y")&&"desc"===n._config.sortBy.y&&(o=n.utils.sortDescending)),n._config.xCategories=e.nest().key(function(t){return t[n._config.x]}).sortKeys(i).entries(t).map(function(t){return t.key}),n._config.yCategories=e.nest().key(function(t){return t[n._config.y]}).sortKeys(o).entries(t).map(function(t){return t.key}),n._config.fillValues=e.nest().key(function(t){return t[n._config.fill]}).entries(t).map(function(t){return Number(t.key)}),n._gridWidth=Math.floor((n._config.size.width-(n._config.size.margin.left+n._config.size.margin.right))/n._config.xCategories.length),n._gridHeight=Math.floor((n._config.size.height-(n._config.size.margin.top+n._config.size.margin.bottom))/n._config.yCategories.length),n._data=t.map(function(t){var e={y:t[n._config.y],x:t[n._config.x],value:+t[n._config.fill]};return t.coefficient&&(e.coefficient=t.coefficient.toFixed(2)),e}),n},i.scales=function(){return this},i.drawColorLegend=function(){var t=this,n=t._config.colors,i=e.scaleBand().rangeRound([.8*t._config.size.height,0]).domain(n),o=e.select(t._config.bindTo).select("svg").append("g").attr("class","legend quantized").attr("transform","translate("+(t._config.size.width-t._config.size.legendTranslate)+","+.1*t._config.size.height+")");o.append("rect").attr("x",-50).attr("y",-35).attr("width",100).attr("height",t._config.size.height-10).attr("rx",10).attr("ry",10).attr("class","legend-background").attr("fill","rgba(255,255,255,0.6)"),o.append("text").attr("x",0).attr("y",-12).attr("class","legend-title").attr("text-anchor","middle").text(t._config.legendTitle);var a=o.selectAll(".quantile").data(t._config.colors).enter().append("g").attr("class","quantile").attr("transform",function(t){return"translate(-20, "+i(t)+")"});a.append("rect").attr("x",-15).attr("y",0).attr("width",18).attr("height",i.bandwidth()).attr("fill",function(t){return t}),a.append("text").attr("x",17).attr("y",5).attr("class","top-label").attr("text-anchor","left").text(function(e){var n=t._scales.color.invertExtent(e)[1];return"Porcentaje"===t._config.legendTitle&&n>100&&(n=100),t.utils.format()(n)}),a.append("text").attr("x",17).attr("y",t._config.size.height/5-18).attr("class","bottom-label").attr("text-anchor","left").text(function(e,n){if(0===n){var i=t._scales.color.invertExtent(e)[0];return t.utils.format()(i)}return""})},i.drawLabels=function(){var t=this,e=t.chart.svg().selectAll(".dbox-label").data(t._data,function(t){return t.y+":"+t.x});e.enter().append("text").attr("text-anchor","middle").attr("transform","translate("+(-t._gridWidth/2+17)+", 20)").attr("dx",function(e){return(t._config.xCategories.indexOf(String(e.x))+1)*t._gridWidth}).attr("dy",function(e){return t._config.yCategories.indexOf(String(e.y))*t._gridHeight}).attr("class","dbox-label").text(function(e){return e.value?t.utils.format()(e.value):""}),e.enter().append("text").attr("transform","translate("+-t._gridWidth/2+", 40)").attr("dx",function(e){return(t._config.xCategories.indexOf(String(e.x))+1)*t._gridWidth}).attr("dy",function(e){return t._config.yCategories.indexOf(String(e.y))*t._gridHeight}).attr("class","dbox-label-coefficient").text(function(t){return t.coefficient?"("+parseFloat(t.coefficient).toFixed(1)+")":""})},i.draw=function(){var t=this;t.chart.svg().call(t._tip);var n=t.utils.d3.tip().html(function(t){return'<div class="title-tip">'+t+"</div>"});if(t.chart.svg().call(n),t._yLabels=t.chart.svg().append("g").attr("class","y axis").attr("transform","translate(17,0)").selectAll(".tick").data(t._config.yCategories).enter().append("g").attr("class","tick").attr("transform",function(e,n){return"translate(0,"+n*t._gridHeight+")"}).append("text").attr("text-anchor","end").attr("transform","translate(-6,"+t._gridHeight/1.5+")").text(function(t){return t}),t._yLabels.each(function(i){var o=this;this.getComputedTextLength()>.9*t._config.size.margin.left&&function(){e.select(o).on("mouseover",n.show).on("mouseout",n.hide);for(var a=1;o.getComputedTextLength()>.8*t._config.size.margin.left;)e.select(o).text(function(t){return t.slice(0,-a)+"..."}).attr("title",i),++a}()}),t._config.yAxis&&t._config.yAxis.text){var o=t.chart.svg().select(".y.axis");o.selectAll(".y-title").remove(),t._yTitle=o.append("g").attr("class","y-title").attr("transform",function(e,n){return"translate(0,"+n*t._gridHeight+")"}).append("text").attr("class","axis-title").attr("font-size",17).attr("font-weight",600).attr("text-anchor","middle").attr("transform","translate(-"+(t._config.size.margin.left-3)+", "+(t._config.size.height-t._config.size.margin.bottom)/2+" )rotate(-90)").text(t._config.yAxis.text)}t._xLabels=t.chart.svg().append("g").attr("class","x axis").attr("transform","translate(23,0)").selectAll(".tick").data(t._config.xCategories).enter().append("g").attr("class","tick").attr("transform",function(e,n){return"translate("+(n*t._gridWidth+t._gridWidth/2)+","+(t._config.yCategories.length*t._gridHeight+20)+")"}).append("text").attr("text-anchor","middle").text(function(t){return t});var a=e.max(e.select(".x.axis").selectAll("text").nodes().map(function(t){return t.getComputedTextLength()})),r=t._gridWidth,s=r;if(a>r&&t._xLabels.each(function(i){var o=this;if(e.select(this).attr("text-anchor","end").attr("dy",0).attr("transform","translate(-5,-10)rotate(-90)"),s=.75*t._config.size.margin.bottom,!(this.getComputedTextLength()>s))return i;!function(){e.select(o).on("mouseover",n.show).on("mouseout",n.hide);for(var t=1;o.getComputedTextLength()>s;)e.select(o).text(function(e){return e.slice(0,-t)+"..."}).attr("title",i),++t}()}),t._config.xAxis&&t._config.xAxis.text){var c=t.chart.svg().select(".x.axis");c.selectAll(".x-title").remove(),t._xTitle=c.append("g").attr("class","x-title").attr("transform",function(e,n){return"translate(0,"+n*t._gridHeight+")"}).append("text").attr("class","axis-title").attr("font-size",17).attr("font-weight",600).attr("text-anchor","middle").attr("transform","translate("+(t._config.size.width-t._config.size.margin.left-t._config.size.margin.right)/2+", "+(t._config.size.height-20)+")").text(t._config.xAxis.text)}return t._scales.color=e.scaleQuantile().domain(t._data.map(function(t){return t.value}).sort()).range(t._config.colors),t.chart.svg().append("g").attr("class","grid-container").attr("transform","translate(17, 0)").selectAll(".grid-cell").data(t._data,function(t){return t.y+":"+t.x}).enter().append("rect").attr("x",function(e){return t._config.xCategories.indexOf(String(e.x))*t._gridWidth}).attr("y",function(e){return t._config.yCategories.indexOf(String(e.y))*t._gridHeight}).attr("rx",t._config.borderRadius||5).attr("ry",t._config.borderRadius||5).attr("class","grid-cell").attr("stroke","#fff").attr("stroke-width","2px").attr("id",function(t){return"x"+t.x+"y"+t.y}).attr("width",t._gridWidth).attr("height",t._gridHeight).on("mouseover",function(n,i){t._tip.show(n,e.select(this).node()),t._config.hasOwnProperty("mouseover")&&t._config.mouseover.call(t,n,i)}).on("mouseout",function(n,i){t._tip.hide(n,e.select(this).node()),t._config.hasOwnProperty("mouseout")&&t._config.mouseout.call(this,n,i)}).on("click",function(e,n){t._config.hasOwnProperty("onclick")&&t._config.onclick.call(this,e,n)}).attr("fill",function(e){return t._scales.color(e.value)}),i.drawLabels(),t._config.hasOwnProperty("legendTitle")&&i.drawColorLegend(),t},i.init(t),i}function l(t,n){var i=Object.create(n);return i.init=function(t){var n=this;n._config=t||{},n._scales={},n._axes={},n._data=[],n._scales.color=e.scaleQuantize().range(["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"])},i.id=function(t){var e=this;return e._config.id=t,e},i.fill=function(t){var e=this;return e._config.fill=t,e},i.opacity=function(t){var e=this;return e._config.opacity=t,e},i.colors=function(t){var e=this;return e._config.colors=t,t&&Array.isArray(t)?e._scales.color.range(t):"function"==typeof t&&(e._scales.color=t),e},i.colorLegend=function(t){var e=this;return e._config.legendTitle=t,e},i.data=function(t){var n=this;n._topojson=!!t[1]&&t[1],t=t[0],n._config.data.filter&&(t=t.filter(n._config.data.filter)),n._data=t,n._minMax=e.extent(t,function(t){return+t[n._config.fill]}),n._scales.color.domain(n._minMax);var i=n._config.map.topojson.objects;if(n._nodes=[],Array.isArray(i))for(var o=0;o<i.length;o++){var a=i[o];n._topojson.objects[a].geometries.forEach(function(t){t.id=n._config.map.topojson.parser(t);var e=n._data.filter(function(e){return e[n._config.id]==t.id})[0];e&&(t.properties[n._config.fill]=e[n._config.fill]),n._nodes.push(t)})}else i&&n._topojson.objects[i].geometries.forEach(function(t){t.id=n._config.map.topojson.parser(t);var e=n._data.filter(function(e){return e[n._config.id]==t.id})[0];e&&(t.properties[n._config.fill]=e[n._config.fill]),n._nodes.push(t)});return n},i.scales=function(){return this},i.drawColorLegend=function(){var t=this,n=t._scales.color.range().length,i=(t._minMax[1],t._minMax[0],t._config.colors),o=e.scaleBand().rangeRound([.8*t._config.size.height,0]).domain(i),a=e.select("#"+t._config.bindTo).append("svg").attr("width",120).attr("height",t._config.size.height).style("z-index",401).style("position","absolute").style("top","4px").style("right","2px").append("g").attr("class","legend quantized").attr("transform","translate(50,25)");a.append("rect").attr("x",-50).attr("y",-35).attr("width",100).attr("height",t._config.size.height-10).attr("rx",10).attr("ry",10).attr("class","legend-background").attr("fill","rgba(255,255,255,0.6)"),a.append("text").attr("x",0).attr("y",-12).attr("class","legend-title").attr("text-anchor","middle").text(t._config.legendTitle);var r=a.selectAll(".quantile").data(t._config.colors).enter().append("g").attr("class","quantile").attr("transform",function(t){return"translate(-20, "+o(t)+")"});r.append("rect").attr("x",-10).attr("y",0).attr("width",18).attr("height",o.bandwidth()).attr("fill",function(t){return t}),r.append("text").attr("x",17).attr("y",5).attr("class","top-label").attr("text-anchor","left").text(function(e){var n=t._scales.color.invertExtent(e)[1];return"Porcentaje"===t._config.legendTitle&&n>100&&(n=100),t._config.map.formatLegend?t._config.map.formatLegend(n):t.utils.format(n)}),r.append("text").attr("x",17).attr("y",t._config.size.height/5-11).attr("class","bottom-label").attr("text-anchor","left").text(function(e,n){if(0===n){var i=t._scales.color.invertExtent(e)[0];return t._config.map.formatLegend?t._config.map.formatLegend(i):t.utils.format(i)}return""})},i.draw=function(){function t(t){var i=t.feature.properties[a._config.fill];if(i){var r=a._scales.color(i);t.setStyle({fillColor:r,fillOpacity:a._config.opacity||.7,color:"#555",weight:1,opacity:.5}),a.drawLabel(t),t.on({mouseover:function(){n(t)},mouseout:function(){o(t)}})}else e.select(t._path).remove()}function n(t){u.show(t,e.select(t._path).node())}function o(t){u.hide(t)}var a=this,r=(a._config.map.topojson.url,a._config.map.topojson.objects);a._config.map.topojson.translate,a._config.map.topojson.scale,a._config.map.topojson.parser,a._config.map.topojson.id;L.TopoJSON=L.GeoJSON.extend({addData:function(t){var e,n;if("Topology"===t.type)if(r)if(Array.isArray(r))for(var i=0;i<r.length;i++){var o=r[i];e=topojson.feature(t,t.objects[o]),L.GeoJSON.prototype.addData.call(this,e)}else e=topojson.feature(t,t.objects[r]),L.GeoJSON.prototype.addData.call(this,e);else for(n in t.objects)e=topojson.feature(t,t.objects[n]),L.GeoJSON.prototype.addData.call(this,e);else L.GeoJSON.prototype.addData.call(this,t)}});var s={lat:25.5629994,lon:-100.6405644}
;a._config.map.topojson.center&&2===a._config.map.topojson.center.length&&(s.lat=a._config.map.topojson.center[0],s.lon=a._config.map.topojson.center[1]);var c=new L.LatLngBounds(new L.LatLng(s.lat+5,s.lon-5),new L.LatLng(s.lat-5,s.lon+5));a._map=new L.Map(a._config.bindTo,{center:c.getCenter(),zoom:a._config.map.topojson.zoom||7,maxZoom:a._config.map.topojson.maxZoom||10,minZoom:a._config.map.topojson.minZoom||3,maxBounds:c,maxBoundsViscosity:1});var l=L.tileLayer("http://b.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),f=new L.TopoJSON;l.addTo(a._map),function(e){f.addData(e),f.addTo(a._map),f.eachLayer(t)}(a._topojson);var u=a.utils.d3.tip().html(a._config.tip?a._config.tip.bind(this):function(t){return'<div class="d3-tip" style="z-index: 99999;"><span>'+(t.feature.properties.NOM_ENT||t.feature.properties.NOM_MUN)+"</span><br/><span>"+a.utils.format()(t.feature.properties[a._config.fill])+"</span></div>"});return e.select("#"+a._config.bindTo).select("svg.leaflet-zoom-animated").call(u),"function"==typeof a._config.legend&&a._config.legend.call(this,a._nodes),i.drawColorLegend(),a},i.drawLabel=function(t){var n=this,i=t.feature.properties,o=e.select(t._path).node(),a=o.getBBox(),r=e.select("#"+n._config.bindTo).select("svg.leaflet-zoom-animated");return void 0!==i[n._config.fill]&&r.append("text").attr("class","dbox-label").attr("x",a.x+a.width/2).attr("y",a.y+e.min([a.height/2,30])).attr("text-anchor","middle").text((i.NOM_ENT||i.NOM_MUN)+": "+n.utils.format(i[n._config.fill])),n},i.init(t),i}function f(t){function n(t){var n=this;n._config=t||{},n._data=[],n._scales={},n._axes={},n._tip=n.utils.d3.tip().attr("class","d3-tip "+(n._config.tooltip&&n._config.tooltip.classed?n._config.tooltip.classed:"")),n._formatWithZeroDecimals=e.format(",.0f"),n._formatWithOneDecimal=e.format(",.1f"),n._formatWithTwoDecimals=e.format(",.2f"),n._formatWithThreeDecimals=e.format(",.3f"),n._format={},n._format.total=n._formatWithZeroDecimals,n._format.percentage=function(t){return e.format(",.1f")(t)+"%"},n._format.change=e.format(",.1f")}return n.prototype.id=function(t){var e=this;return e._config.id=t,e},n.prototype.color=function(t){var e=this;return e._config.color=t,e},n.prototype.tip=function(t){var e=this;return e._config.tip=t,e._tip.html(e._config.tip),e},n.prototype.onclick=function(t){var e=this;return e._config.onclick=t,e},n.prototype.end=function(){return this._chart},n.prototype.chart=function(t){var e=this;return e._chart=t,e},n.prototype.data=function(t){var n=this;n._topojson=!!t[1]&&t[1];var t=t[0];return n._config.data.filter&&(t=t[0].filter(n._config.data.filter)),n._data=t,n._quantiles=n._setQuantile(t),n._minMax=e.extent(t,function(t){return+t[n._config.color]}),n._config.map.min=n._minMax[0],n._config.map.max=n._minMax[1],n},n.prototype.scales=function(t){var e=this;return e._scales=t,e},n.prototype.axes=function(t){var e=this;return e._axes=t,e},n.prototype.domains=function(){return this},n.prototype.draw=function(){var t=this,n=(t._config.map.topojson.url,t._config.map.topojson.objects),i=t._config.map.topojson.translate,o=t._config.map.topojson.scale,a=t._config.map.topojson.parser,r=t._config.map.topojson.id;t._chart._svg.call(t._tip),t._projection=e.geoMercator().scale(o).translate(i),t.path=e.geoPath().projection(t._projection),t._polygons=t._chart._svg.append("g").attr("id","dbox-map-polygons").style("display","true").attr("transform",function(){return"translate("+t._config.size.translateX+",100) scale("+t._config.size.scale+")"});var s=topojson.feature(t._topojson,t._topojson.objects[n]).features;if(void 0!==t._config.map.topojson.filter){var c=t._config.map.topojson.filter;Object.keys(c).map(function(t){s=s.filter(function(e){return e.properties[t]===c[t]})})}t._polygons.selectAll("path").data(s,a).enter().append("path").attr("d",e.geoPath().projection(t._projection)).attr("id",r).attr("data-geotype",n).attr("fill","#808080").attr("stroke","#a0a0a0").style("stroke-width","1px").on("mouseover",function(n,i){t._config.map.quantiles.colorsOnHover&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.color],"onHover")}),t._config.data.onmouseover&&t._config.data.onmouseover.call(this,n,i)}).on("mouseout",function(n,i){t._config.map.quantiles.colorsOnHover&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.color],"default")}),t._config.data.onmouseout&&t._config.data.onmouseout.call(this,n,i)}).on("click",function(e,n){t._config.data.onclick&&t._config.data.onclick.call(this,e,n)}),t._polygonsDefault=t._polygons.selectAll("path").data(),t._polygons.selectAll("path").attr("stroke","#333").attr("stroke-width",.2),t._polygons.selectAll("path").attr("fill","red"),t._polygons.selectAll("path").attr("data-total",null),t._polygons.selectAll("path").data(t._data,function(e){return e.id?e.id:e[t._config.id]}).attr("fill",function(e){return t._getQuantileColor(e[t._config.color],"default")}).attr("data-total",function(e){return+e[t._config.color]}),t._polygons.selectAll("path").data(t._polygonsDefault,function(t){return t.id})},n.prototype._setQuantile=function(t){var n=this,i=[],o=[];if(n._config.map.quantiles&&n._config.map.quantiles.predefinedQuantiles&&n._config.map.quantiles.predefinedQuantiles.length>0)return n._config.map.quantiles.predefinedQuantiles;if(t.forEach(function(t){i.push(+t[n._config.color])}),i.sort(e.ascending),n._config&&n._config.map&&n._config.map.quantiles&&n._config.map.quantiles.buckets)if(!0===n._config.map.quantiles.ignoreZeros){var a=_.dropWhile(i,function(t){return t<=0});o.push(i[0]),o.push(0);for(var r=1;r<=n._config.map.quantiles.buckets-1;r++)o.push(e.quantile(a,1*r/(n._config.map.quantiles.buckets-1)))}else{o.push(e.quantile(i,0));for(var r=1;r<=n._config.map.quantiles.buckets;r++)o.push(e.quantile(i,1*r/n._config.map.quantiles.buckets))}else o=[e.quantile(i,0),e.quantile(i,.2),e.quantile(i,.4),e.quantile(i,.6),e.quantile(i,.8),e.quantile(i,1)];return n._config.map.quantiles&&n._config.map.quantiles.buckets&&5===n._config.map.quantiles.buckets&&o[1]===o[2]&&o[2]===o[3]&&o[3]===o[4]&&o[4]===o[5]&&(o=[e.quantile(i,0),e.quantile(i,.2)]),o},n.prototype._getQuantileColor=function(t,e){var n=this,i=parseFloat(t);if(n._config&&n._config.map&&n._config.map.quantiles&&n._config.map.quantiles.colors&&n._quantiles.length>2){if(n._config&&n._config.map&&void 0!==n._config.map.min&&void 0!==n._config.map.max){if(i<n._config.map.min||i>n._config.map.max)return console.log("outOfRangeColor",i,n._config.map.min,n._config.map.max),n._config.map.quantiles.outOfRangeColor}else if(i<n._minMax[0]||i>n._minMax[1])return console.log("outOfRangeColor",i,n._config.map.min,n._config.map.max),n._config.map.quantiles.outOfRangeColor;if("default"==e){if(i<=n._quantiles[1])return n._config.map.quantiles.colors[0];if(i<=n._quantiles[2])return n._config.map.quantiles.colors[1];if(i<=n._quantiles[3])return n._config.map.quantiles.colors[2];if(i<=n._quantiles[4])return n._config.map.quantiles.colors[3];if(i<=n._quantiles[5])return n._config.map.quantiles.colors[4]}if("onHover"==e&&n._config.map.quantiles.colorsOnHover){if(i<=n._quantiles[1])return n._config.map.quantiles.colorsOnHover[0];if(i<=n._quantiles[2])return n._config.map.quantiles.colorsOnHover[1];if(i<=n._quantiles[3])return n._config.map.quantiles.colorsOnHover[2];if(i<=n._quantiles[4])return n._config.map.quantiles.colorsOnHover[3];if(i<=n._quantiles[5])return n._config.map.quantiles.colorsOnHover[4]}}if(2==n._quantiles.length&&i<=n._quantiles[1])return n._config.map.quantiles.colors[0]},new n(t)}function u(t){function e(t){var e,n=this;n.CIRCLE_RADIANS=2*Math.PI,n.RADIANS_TO_ROTATE=n.CIRCLE_RADIANS/-4,n._config=t||{},n._data=[],n._scales={},n._axes={},n._axesData={},n._filter=null,n._minMax=[0,0],n._viewData=[],n._colorMap={},n._ticks=0,n._scale=null,n._excludedPolygons=[],n._config.ticks||(n._config.ticks=10),n._config.transitionDuration||(n._config.transitionDuration=400),n._config.axisLabelMargin||(n._config.axisLabelMargin=24),n._config.legend||(n._config.legend={enable:!0}),n._config.legend.at||(n._config.legend.at={x:20,y:20}),void 0===n._config.styleDefaults&&(n._config.styleDefaults=!0),e=n._config.size,n._center={x:e.width/2-e.margin.left,y:e.height/2-e.margin.top},n._radius=Math.min((e.width-e.margin.left-e.margin.right)/2,(e.height-e.margin.top-e.margin.bottom)/2)}return e.prototype.polygonsFrom=function(t){var e=this;return e._config.polygonsFrom=t,e},e.prototype.axesFrom=function(t){var e=this;return e._config.axesFrom=t,e},e.prototype.valuesFrom=function(t){var e=this;return e._config.valuesFrom=t,e},e.prototype.ticks=function(t){var e=this;return e._config.ticks=t,e},e.prototype.colors=function(t){var e=this;return e._config.colors=t,e},e.prototype.end=function(){return this._chart},e.prototype.drawTicks=function(){var t,e=this,n=e._chart._svg,i=e._config.transitionDuration;t=n.select("g.ticks"),t.empty()&&(t=n.append("g").attr("class","ticks")),t=t.selectAll("circle.tick").data(e._ticks.map(function(t,e){return[e,t]}).reverse(),function(t){return t[0]}),t.transition().duration(i).attr("r",function(t){return e._scale(t[1])}),t.enter().append("circle").classed("tick",!0).attr("cx",e._center.x).attr("cy",e._center.y).style("fill",e._ifStyleDefaults("none")).style("stroke",e._ifStyleDefaults("gray")).attr("r",function(t){return e._scale(t[1])}).attr("opacity",0).transition().duration(i).attr("opacity",1),t.exit().transition().duration(i).attr("opacity",0).remove()},e.prototype.drawTicksLabels=function(){var t,e=this,n=e._chart._svg,i=e._config.transitionDuration;t=n.select("g.ticks-labels"),t.empty()&&(t=n.append("g").attr("class","ticks-labels")),t=t.selectAll("text.tick-label").data(e._ticks),t.transition().duration(i).text(function(t){return t}).attr("y",function(t){return e._center.y-2-e._scale(t)}),t.enter().append("text").text(function(t){return t.toFixed(1)}).attr("class","tick-label").attr("x",e._center.x+2).attr("y",function(t){return e._center.y-2-e._scale(t)}).attr("fill",e._ifStyleDefaults("gray")).style("font-family",e._ifStyleDefaults("sans-serif")).attr("opacity",0).transition().duration(i).attr("opacity",1),t.exit().transition().duration(i).attr("opacity",0).remove()},e.prototype.extractAxes=function(t){var e,n,i=this,o=i._config.axesFrom;return e=t.reduce(function(t,e){return t.indexOf(e[o])>-1?t:t.concat(e[o])},[]),n=i.CIRCLE_RADIANS/e.length,e=e.map(function(t,e){return{axis:t,rads:e*n+i.RADIANS_TO_ROTATE}}),{list:e,hash:e.reduce(function(t,e){return t[e.axis]=e,t},{})}},e.prototype.buildColorMap=function(t){var e=this,n=e._config.colors;return t.reduce(function(t,i){var o=i[e._config.polygonsFrom],a=t.index.indexOf(o);return-1==a&&(a=t.index.push(o)-1,t.hash[o]=n[a],t.list.push({polygon:o,color:n[a]})),t},{index:[],hash:{},list:[]})},e.prototype.drawAxes=function(){var t,e=this,n=e._chart._svg,i=e._config.transitionDuration;t=n.selectAll("line.axis").data(e._axesData.list,function(t){return t.axis}),t.enter().append("line").classed("axis",!0).attr("x1",e._center.x).attr("y1",e._center.y).style("stroke",e._ifStyleDefaults("gray")).attr("x2",e._center.x).attr("y2",e._center.y).transition().duration(i).attr("x2",function(t){return e.xOf(t.rads,e._radius+8)}).attr("y2",function(t){return e.yOf(t.rads,e._radius+8)}),t.transition().duration(i).attr("x2",function(t){return e.xOf(t.rads,e._radius+8)}).attr("y2",function(t){return e.yOf(t.rads,e._radius+8)}),t.exit().transition().duration(i).attr("x2",e._center.x).attr("y2",e._center.y).remove()},e.prototype.drawAxesLabels=function(){var t,e,n=this,i=n._chart._svg,o=n._config.transitionDuration,a=n._radius+n._config.axisLabelMargin;e=i.selectAll("rect.axis-label").data(n._axesData.list,function(t){return t.axis}),e.enter().append("rect").attr("class","axis-label").attr("x",function(t){return n.xOf(t.rads,a)-50}).attr("y",function(t){return n.yOf(t.rads,a)-20}).attr("rx","5px").attr("ry","5px").attr("width","100px").attr("height","40px").attr("fill","#A3A3AF").attr("opacity",0).transition().duration(o).attr("opacity",1),e.exit().transition().duration(o).attr("opacity",0).remove(),t=i.selectAll("text.axis-label").data(n._axesData.list,function(t){return t.axis}),t.transition().duration(o).attr("x",function(t){return n.xOf(t.rads,a+5)}).attr("y",function(t){return n.yOf(t.rads,a+5)}),t.enter().append("text").attr("class","axis-label").attr("text-anchor","middle").attr("fill","white").style("font-family",n._ifStyleDefaults("sans-serif")).text(function(t){return t.axis}).attr("x",function(t){return n.xOf(t.rads,a+5)}).attr("y",function(t){return n.yOf(t.rads,a+5)}).attr("opacity",0).transition().duration(o).attr("opacity",1),t.exit().transition().duration(o).attr("opacity",0).remove()},e.prototype.drawPolygons=function(){var t,e,n,i,o=this,a=o._viewData,r=o._chart._svg,s=o._config.transitionDuration;t=a.reduce(function(t,e){var n=t.keys.indexOf(e.polygon);return-1==n&&(n=t.keys.push(e.polygon)-1,t.polygons.push({polygon:e.polygon,color:e.color,points:[],values:[],rawData:e.rawData})),t.polygons[n].values.push(e),t.polygons[n].points.push(e.xy.join(",")),t},{keys:[],polygons:[]}).polygons,e=r.selectAll("g.polygon-container").data(t,function(t){return t.polygon+"-container"}),i=e.enter().append("g").attr("class","polygon-container").attr("id",function(t){return"radar-id-"+t.rawData.CVE_ENT}),n=e.exit(),n.transition().duration(s).remove(),o._buildNestedPolygons(e,i,n),o._buildNestedVertexes(e,i,n)},e.prototype._buildNestedVertexes=function(t,e,n){function i(t){t.append("circle").attr("class","vertex").attr("cx",l._center.x).attr("cy",l._center.y).attr("r",4).attr("fill",function(t){return t.color}).call(a).on("mouseover",function(t){var e=t.xy[0]+10,n=t.xy[1]-10;l._showTooltip(e,n,t.polygon,t.value)}).on("mouseout",function(){l._hideTooltip()})}function o(t){t.transition().duration(f).attr("cx",l._center.x).attr("cy",l._center.y).remove()}function a(t){t.transition().duration(f).attr("cx",function(t){return t.xy[0]}).attr("cy",function(t){return t.xy[1]})}function r(t){return t.values}function s(t){return t.polygon+"-"+t.axis}var c,l=this,f=l._config.transitionDuration;c=t.selectAll("circle.vertex").data(r,s),c.call(a),c.enter().call(i),c.exit().call(o),e.selectAll("circle.vertex").data(r,s).enter().call(i),n.selectAll("circle.vertex").call(o)},e.prototype._showTooltip=function(t,e,n,i){var o,a,r,s,c=this;return o=c._chart._svg.append("g").attr("class","tooltip").attr("opacity",0),r=o.append("rect").attr("class","tooltip-background"),a=o.append("text").attr("y",e).attr("x",t).style("fill",c._ifStyleDefaults("white")).style("font-family",c._ifStyleDefaults("sans-serif")),a.append("tspan").text(Number(i).toFixed(1)),a.append("tspan").attr("dy","-1.2em").attr("x",t).text(n),s=o.node().getBBox(),r.attr("x",s.x-2).attr("y",s.y-2).attr("width",s.width+4).attr("height",s.height+4).style("fill",c._ifStyleDefaults("gray")),o.transition().duration(200).attr("opacity",.9),o},e.prototype._hideTooltip=function(){this._chart._svg.selectAll("g.tooltip").transition().duration(200).attr("opacity",0).remove()},e.prototype._buildNestedPolygons=function(t,e,n){function i(t){var e=[f._center.x,f._center.y].join(",");return t.points.map(function(){return e}).join(" ")}function o(t){t.append("polygon").attr("class","category").attr("points",i).style("stroke",function(t){return t.color}).style("fill",function(t){return t.color}).style("fill-opacity",.4).style("stroke-width",f._ifStyleDefaults("1px")).call(r)}function a(t){t.transition().duration(u).attr("points",i).remove()}function r(t){t.transition().duration(u).attr("points",function(t){return t.points.join(" ")})}function s(t){return[t]}function c(t){return t.polygon}var l,f=this,u=f._config.transitionDuration,g="polygon.category";l=t.selectAll(g).data(s,c),l.call(r),l.enter().call(o),l.exit().call(a),e.selectAll(g).data(s,c).enter().call(o),n.selectAll(g).call(a)},e.prototype.drawLegend=function(){var t,e,n=this,i=n._colorMap.list,o=n._chart._svg,a=n._config.legend.at;t=o.selectAll("g.legend-item").data(i,function(t){return t.polygon}).attr("opacity",function(t){return n._excludedPolygons.indexOf(t.polygon)>-1?.4:1}),e=t.enter().append("g").on("click",function(t){n._excludedPolygons=n._toggleList(n._excludedPolygons,[t.polygon]),n.draw()}).attr("class","legend-item"),e.append("text").text(function(t){return t.polygon}).attr("x",a.x+14+4).attr("y",function(t,e){return 18*e+a.y+14}).style("font-family",n._ifStyleDefaults("sans-serif")),e.append("rect").attr("fill",function(t){return t.color}).attr("width",14).attr("height",14).attr("x",a.x).attr("y",function(t,e){return 18*e+a.y})},e.prototype._ifStyleDefaults=function(t){return this._config.styleDefaults?t:null},e.prototype._toggleList=function(t,e){var n=e.filter(function(e){return-1==t.indexOf(e)});return t.filter(function(t){return-1==e.indexOf(t)}).concat(n)},e.prototype.xOf=function(t,e){return this._center.x+e*Math.cos(t)},e.prototype.yOf=function(t,e){return this._center.y+e*Math.sin(t)},e.prototype.minMax=function(t){var e=this;return t.reduce(function(t,n){var i=parseInt(n[e._config.valuesFrom]);return 0==t.length?[i,i]:[i<t[0]?i:t[0],i>t[1]?i:t[1]]},[])},e.prototype.dataForVisualization=function(t){var e=this,n=e._scale,i=e._config.axesFrom,o=e._config.valuesFrom,a=e._config.polygonsFrom,r=e._axesData.hash;return t.map(function(t){var s=t[i],c=r[s].rads,l=t[a],f=t[o],u=n(f);return{xy:[e.xOf(c,u),e.yOf(c,u)],value:f,polygon:l,axis:s,color:e._colorMap.hash[l],rawData:t}})},e.prototype.filter=function(t){var e=this;return e._filter=t,e},e.prototype.chart=function(t){var e=this;return e._chart=t,e},e.prototype.data=function(t){var e=this;return e._config.data.filter&&(t=t.filter(e._config.data.filter)),e._data=t,e},e.prototype.scales=function(t){var e=this;return e._scales=t,e._scale=e._scales.x,e._scale.range([0,e._radius]),e},e.prototype.axes=function(t){return this},e.prototype.domains=function(){var t=this;return t._calcDomains(t._data),t},e.prototype._calcDomains=function(t){var e=this;e._minMax=e.minMax(t),e._scale.domain(e._config.scales&&e._config.scales.x&&e._config.scales.x.domain&&Array.isArray(e._config.scales.x.domain)?e._config.scales.x.domain:[0,e._minMax[1]]),e._ticks=e._scale.ticks(e._config.ticks),e._ticks.length>0&&0===e._ticks[0]&&(e._ticks=e._ticks.slice(1))},e.prototype.draw=function(){var t=this,e=t._data;t._colorMap=t.buildColorMap(e),"function"==typeof t._filter&&(e=e.filter(t._filter)),t._excludedPolygons.length>0&&(e=e.filter(function(e){return-1==t._excludedPolygons.indexOf(e[t._config.polygonsFrom])})),t._calcDomains(e),t._axesData=t.extractAxes(e),t._viewData=t.dataForVisualization(e),t.drawTicks(),t.drawAxes(),t.drawAxesLabels(),t.drawTicksLabels(),t.drawPolygons(),t.drawLegend()},new e(t)}function g(t,n){var i=Object.create(n);return i.init=function(t){var e=this;e._config=t||{},e._data=[],e._scales={},e._axes={};var n=function(t){var n;return e.chart.config.styles?(n="<div style='\n        line-height: 1; \n        opacity: "+e.chart.style.tooltip.opacity+"; \n        font-weight: "+e.chart.style.tooltip.text.fontWeight+"; \n        font-size: "+e.chart.style.tooltip.text.fontSize+"; \n        color: "+e.chart.style.tooltip.text.textColor+";\n        font-family: "+e.chart.style.tooltip.text.fontFamily+";\n        background-color: "+e.chart.style.tooltip.backgroundColor+"; \n        padding: "+e.chart.style.tooltip.text.padding+";   \n        border: "+e.chart.style.tooltip.border.width+" solid "+e.chart.style.tooltip.border.color+";  \n        border-radius:  "+e.chart.style.tooltip.border.radius+";'>",n+="<strong style='color:"+e.chart.style.tooltip.text.fontColor+";'>"):n="<div> <strong>",n+=e._config.idName&&t.datum[e._config.idName]?t.datum[e._config.idName]+"<br>":"",n+=t.x?"<span>("+(Number.isNaN(+t.x)||"linear"!==e._config.xAxis.scale?t.x:e.utils.format(e._config.xAxis)(t.x))+"</span>":"(NA",n+=t.y?"<span>, &nbsp;"+(Number.isNaN(+t.y)||"linear"!==e._config.yAxis.scale?t.y:e.utils.format(e._config.yAxis)(t.y))+")</span>":", NA)",n+=" </strong><br>",e._config.magnitude&&t.magnitude!==t.x&&t.magnitude!==t.y&&(n+=t.magnitude?"<span>"+(Number.isNaN(+t.magnitude)||+t.magnitude>=1993&&+t.magnitude<=2019?t.magnitude:e.utils.format()(t.magnitude))+"</span>":""),t.color!==t.x&&t.color!==t.y&&t.color!==t.magnitude&&(n+=t.color?"<span> "+(Number.isNaN(+t.color)||+t.color>=1993&&+t.color<=2019?t.color:e.utils.format()(t.color))+"</span>":""),n+="</div>"};e._tip=this.utils.d3.tip().attr("class","d3-tip").html(e._config.tip&&e._config.tip.html?e._config.tip.html:n)},i.id=function(t){var e=this;return e._config.id=t,e},i.idName=function(t){var e=this;return e._config.idName=t,e},i.x=function(t){var e=this;return e._config.x=t,e},i.y=function(t){var e=this;return e._config.y=t,e},i.radius=function(t){var e=this;return e._config.radius=t,e},i.magnitude=function(t){var e=this;return e._config.magnitude=t,e},i.radiusRange=function(t){var e=this;return e._config.radiusRange=t,e},i.magnitudeRange=function(t){var e=this;return e._config.magnitudeRange=t,e},i.properties=function(t){var e=this;return e._config.properties=t,e},i.figure=function(t){var e=this;return e._config.figureType=t,e},i.colors=function(t){var e=this;return Array.isArray(t)?e._config.colors=t:e._scales.color=t,e},i.fill=function(t){var e=this;return e._config.fill=t,e},i.opacity=function(t){var e=this;return e._config.opacity=t,e},i.regression=function(t){var e=this;return e._config.regression=t,e},i.tip=function(t){var e=this;return e._config.tip=t,e._tip.html(e._config.tip),e},i.data=function(t){var n,i,o,a,r,s,c,l,f=this;return f._data=[],t.forEach(function(t){var e={};e.datum=t,e.x="linear"==f._config.xAxis.scale?+t[f._config.x]:t[f._config.x],e.y="linear"==f._config.yAxis.scale?+t[f._config.y]:t[f._config.y],"linear"==f._config.xAxis.scale&&Number.isNaN(e.x)&&(e.x=0),"linear"==f._config.yAxis.scale&&Number.isNaN(e.y)&&(e.y=0),e.color="#"!==f._config.fill.slice(0,1)?t[f._config.fill]:f._config.fill,e.radius=void 0!==f._config.radius?isNaN(f._config.radius)?+t[f._config.radius]:f._config.radius:7,e.magnitude=void 0!==f._config.magnitude?isNaN(f._config.magnitude)?+t[f._config.magnitude]:f._config.magnitude:7,void 0!==f._config.properties&&Array.isArray(f._config.properties)&&f._config.properties.length>0&&f._config.properties.forEach(function(n){e[n]=t[n]}),f._data.push(e)}),!0===f._config.regression&&"linear"===f._config.yAxis.scale&&"linear"===f._config.xAxis.scale&&(o=e.mean(t.map(function(t){return Number.isNaN(+t[f._config.x])?0:+t[f._config.x]})),a=e.mean(t.map(function(t){return Number.isNaN(+t[f._config.y])?0:+t[f._config.y]})),n=0,i=0,c=0,l=0,f._data.forEach(function(t){n=Number.isNaN(+t.x)?-o:+t.x-o,i=Number.isNaN(+t.y)?-a:+t.y-a,c+=n*i,l+=n*n}),r=c/l,s=a-r*o,f._data.forEach(function(t){t.yhat=s+Number(t.x)*r})),"linear"!==f._config.yAxis.scale&&f._data.sort(function(t,e){return f.utils.sortAscending(t.y,e.y)}),"linear"!==f._config.xAxis.scale&&f._data.sort(function(t,e){return f.utils.sortAscending(t.x,e.x)}),f},i.scales=function(){var n=this;n._config.hasOwnProperty("x")&&n._config.hasOwnProperty("y")&&(t={column:"x",type:n._config.xAxis.scale,range:[0,n.chart.width],minZero:!!n._config.xAxis.minZero&&n._config.xAxis.minZero},n._scales.x=n.utils.generateScale(n._data,t),t={column:"y",type:n._config.yAxis.scale,range:[n.chart.height,0],minZero:!!n._config.yAxis.minZero&&n._config.yAxis.minZero},n._scales.y=n.utils.generateScale(n._data,t)),n._config.hasOwnProperty("colors")?n._scales.color=e.scaleOrdinal(n._config.colors):n._scales.color=e.scaleOrdinal(e.schemeCategory20c);var i=e.extent(n._data,function(t){return t.radius}),o=e.extent(n._data,function(t){return t.magnitude});return n._scales.radius=e.scaleLinear().range(void 0!=n._config.radiusRange?n._config.radiusRange:[7,20]).domain(i).nice(),n._scales.magnitude=e.scaleLinear().range(void 0!=n._config.magnitudeRange?n._config.magnitudeRange:[7,20]).domain(o).nice(),n._config.xAxis.scaleDomain&&Array.isArray(n._config.xAxis.scaleDomain)&&n._scales.x.domain(n._config.xAxis.scaleDomain),n._config.yAxis.scaleDomain&&Array.isArray(n._config.yAxis.scaleDomain)&&n._scales.y.domain(n._config.yAxis.scaleDomain),n},i.drawLabels=function(){var t=this,e=[],n=[],i=[];t.chart.svg().selectAll(".dbox-label").data(t._data).enter().append("text").attr("class","dbox-label").attr("transform",function(o,a){var r;r="ordinal"==t._config.xAxis.scale||"band"==t._config.xAxis.scale?t._scales.x(o.x)+t._scales.x.bandwidth()/2-t._scales.magnitude(o.magnitude)/2:t._scales.x(o.x),n.push(o.datum[t._config.x]);var s,c=15;if("ordinal"==t._config.yAxis.scale||"band"==t._config.yAxis.scale){if(s=t._scales.y(o.y)+t._scales.y.bandwidth()/2-t._scales.magnitude(o.magnitude)/2,-1!==e.indexOf(Math.ceil(s))){i.push(Math.ceil(s));for(var l=null,f=0,u=0;u<i.length;u++)i[u]!=l?(l=i[u],f=1):f++,c*=f;s+=c}}else if(s=t._scales.y(o.y),-1!==e.indexOf(Math.ceil(s))){i.push(Math.ceil(s));for(var g=null,d=0,_=0;_<i.length;_++)i[_]!=g?(g=i[_],d=1):d++,c*=d;s+=c}return e.push(Math.ceil(s)),n[a-1]!==o.datum[t._config.x]&&(e=[],i=[]),"translate("+(r+10)+","+(s-20)+")"}).text(function(e){var n="";return n+=e.color?e.color:"",n+=" ",n+=e.datum[t._config.magnitude]?t.utils.format(null,!0)(e.datum[t._config.magnitude]):""})},i.draw=function(){var t=this;if(t.chart.svg().call(t._tip),"square"===t._config.figureType?t.chart.svg().selectAll("square").data(t._data).enter().append("rect").attr("class","square").attr("class",function(e,n){var i=void 0!==e.properties&&void 0!==e.properties.id&&e.properties.id;return i=!!t._config.id&&t._config.id,i?"scatter-"+e.datum[i]:"scatter-"+n}).attr("width",function(e){return t._scales.magnitude(e.magnitude)}).attr("height",function(e){return t._scales.magnitude(e.magnitude)}).attr("x",function(e){return"ordinal"==t._config.xAxis.scale||"band"==t._config.xAxis.scale?t._scales.x(e.x)+t._scales.x.bandwidth()/2-t._scales.magnitude(e.magnitude)/2:t._scales.x(e.x)}).attr("y",function(e){return"ordinal"==t._config.yAxis.scale||"band"==t._config.yAxis.scale?t._scales.y(e.y)+t._scales.y.bandwidth()/2-t._scales.magnitude(e.magnitude)/2:t._scales.y(e.y)}).style("fill",function(e){return"#"!==String(e.color).slice(0,1)?t._scales.color(e.color):e.color}).style("opacity",void 0!==t._config.opacity?t._config.opacity:1).on("mouseover",function(n,i){t._config.events.mouseover&&t._config.events.mouseover.call(t,n,i),t._tip.show(n,e.select(this).node())}).on("mouseout",function(n,i){t._config.events.mouseout&&t._config.events.mouseout.call(this,n,i),t._tip.hide(n,e.select(this).node())}).on("click",function(e,n){t._config.events.onClickElement&&t._config.events.onClickElement.call(this,e,n)}):t.chart.svg().selectAll(".dot").data(t._data).enter().append("circle").attr("class","dot").attr("class",function(e,n){var i=void 0!==e.properties&&void 0!==e.properties.id&&e.properties.id;return i=!!t._config.id&&t._config.id,i?"scatter-"+e.datum[i]:"scatter-"+n}).attr("r",function(e){return t._scales.radius(e.radius)}).attr("cx",function(e){return"ordinal"==t._config.xAxis.scale||"band"==t._config.xAxis.scale?t._scales.x(e.x)+t._scales.x.bandwidth()/2:t._scales.x(e.x)}).attr("cy",function(e){return"ordinal"==t._config.yAxis.scale||"band"==t._config.yAxis.scale?t._scales.y(e.y)+t._scales.y.bandwidth()/2:t._scales.y(e.y)}).style("fill",function(e){return"#"!==String(e.color).slice(0,1)?t._scales.color(e.color):e.color}).style("opacity",void 0!==t._config.opacity?t._config.opacity:1).on("mouseover",function(n,i){t._config.events.mouseover&&t._config.events.mouseover.call(t,n,i),t._tip.show(n,e.select(this).node())}).on("mouseout",function(n,i){t._config.events.mouseout&&t._config.events.mouseout.call(this,n,i),t._tip.hide(n,e.select(this).node())}).on("click",function(e,n){t._config.events.onClickElement&&t._config.events.onClickElement.call(this,e,n)}),!0===t._config.regression){var n=e.line().x(function(e){return t._scales.x(e.x)}).y(function(e){return t._scales.y(e.yhat)});t.chart.svg().append("path").datum(t._data).attr("class","line").attr("d",n).style("stroke","rgb(251, 196, 58)")}return i.drawLabels(),t},i.select=function(t){return this.chart.svg().select("circle.scatter-"+t)},i.selectAll=function(){return this.chart.svg().selectAll("circle")},i.init(t),i}function d(t,i){var o=Object.create(i);return o.init=function(t){var e=this;e._config=t||{},e._config.orientation="horizontal",e._data=[],e._scales={},e._tip=e.utils.d3.tip().attr("class","d3-tip "+(e._config.tooltip&&e._config.tooltip.classed?e._config.tooltip.classed:"")).direction("n").html(e._config.tip||function(t){var n="<div>";return n+="<span>"+t[e._config.category]+"</span>",n+="</br><span>"+e.utils.format()(t[e._config.value])+"</span>",n+="</div>"})},o.id=function(t){var e=this;return e._config.id=t,e},o.category=function(t){var e=this;return e._config.category=t,e},o.value=function(t){var e=this;return e._config.value=t,e},o.orientation=function(t){var e=this;return e._config.orientation=t,e},o.stackBy=function(t){var e=this;return e._config.stackBy=t,e},o.fill=function(t){var e=this;return e._config.fill=t,e},o.colors=function(t){var e=this;return Array.isArray(t)?e._config.colors=t:e._scales.color=t,e},o.sortBy=function(t){var e=this;return e._config.sortBy=t,e},o.format=function(t){var n=this;return"function"==typeof t||t instanceof Function?n.utils.format=t:n.utils.format=e.format(t),n},o.tip=function(t){var e=this;return e._config.tip=t,e},o.legend=function(t){var e=this;return e._config.legend=t,e},o.data=function(t){var n=this;n._config.filter&&(t=t.filter(n._config.filter)),n._config.sortBy?(n._config.sortBy.category&&(t=t.sort(function(t,e){return"desc"===n._config.sortBy.category?n.utils.sortDescending(t[n._config.category],e[n._config.category]):n.utils.sortAscending(t[n._config.category],e[n._config.category])})),n._config.sortBy.value&&(t=t.sort(function(t,e){return"desc"===n._config.sortBy.value?n.utils.sortDescending(t[n._config.value],e[n._config.value]):n.utils.sortAscending(t[n._config.value],e[n._config.value])}))):t=t.sort(function(t,e){return n.utils.sortAscending(t[n._config.category],e[n._config.category])});var i=0;return n._data=t.map(function(t){return t.x0=i,t.x1=i+t[n._config.value],i+=+t[n._config.value],n._config.hasOwnProperty("stackBy")&&Array.isArray(n._config.stackBy)&&n._config.stackBy.length>0&&(t.stackValues=e.stack().keys(n._config.stackBy)([t]),t.totalCollapse=e.sum(t.stackValues,function(t){return t[0][1]-t[0][0]})),t}),n._config.hasOwnProperty("quantiles")&&(n._quantiles=n._setQuantile(t),n._minMax=e.extent(t,function(t){return+t[n._config.fill]})),n},o.scales=function(){var t,n=this;return n._config.hasOwnProperty("category")&&n._config.hasOwnProperty("value")&&(t={column:"x1",type:"linear",range:[0,n.chart.width],minZero:!0},n._scales.x=n.utils.generateScale(n._data,t),t={column:n._config.value,type:"linear",range:[n.chart.height,0],minZero:!0},n._scales.y=n.utils.generateScale(n._data,t)),"horizontal"===n._config.orientation&&n._config.hasOwnProperty("stackBy")&&(t={column:"x1",type:"linear",range:[0,n.chart.width],minZero:!0},n._scales.x=n.utils.generateScale(n._data,t),t={column:"",type:"linear",range:[n.chart.height,0],minZero:!0},n._scales.y=e.scaleLinear().range(t.range).domain([0,1])),"vertical"===n._config.orientation&&n._config.hasOwnProperty("stackBy")&&(t={column:"",txpe:"linear",range:[n.chart.height,0],minZero:!0},n._scales.x=e.scaleLinear().range(t.range).domain([0,1]),t={column:n._config.value,type:"linear",range:[0,n.chart.width],minZero:!0},n._scales.y=n.utils.generateScale(n._data,t)),n._config.hasOwnProperty("colors")?n._scales.color=e.scaleOrdinal(n._config.colors):n._scales.color=e.scaleOrdinal(e.schemeCategory10),n},o.drawLabels=function(){var t=this;t.chart.svg().selectAll(".division").each(function(n){var i=this;n.stackValues.forEach(function(n){
var o=t._scales.x(n[0].data[t._config.value]);t._scales.y(n[0][0]/n[0].data.totalCollapse)-t._scales.y(n[0][1]/n[0].data.totalCollapse)>25&&o>112&&e.select(i).append("text").attr("class","dbox-label").attr("text-anchor","middle").attr("transform",function(){return"translate("+(t._scales.x(n[0].data.x0)+o/2)+","+(n[0][1]?t._scales.y(n[0][1]/n[0].data.totalCollapse)+20:t._scales.y(0)+20)+")"}).text(function(){return"X: "+t.utils.format(t._config.xAxis)(n[0].data[t._config.value])+", Y: "+t.utils.format(t._config.yAxis)(n[0].data[n.key])})})})},o.draw=function(){var t=this;if(t._config.hasOwnProperty("stackBy"))return"horizontal"===t._config.orientation&&t._drawStackByXAxis(),"vertical"===t._config.orientation&&t._drawStackByYAxis(),t;t.chart.svg().call(t._tip);var n=t.utils.d3.tip().attr("class","title-tip").html(function(e){return e[t._config.category]});if(t.chart.svg().call(n),"horizontal"===t._config.orientation){var i=[];t._xLabels=t.chart.svg().append("g").attr("class","x axis").attr("transform","translate(0,"+(t.chart.height+20)+")").selectAll(".tick").data(t._data).enter().append("g").attr("class","tick").attr("transform",function(e){var n=t._scales.x(e.x0)+t._scales.x(e.x1-e.x0)/2;return i.push(n),"translate("+n+", 8)"}).append("text").attr("text-anchor","middle").text(function(e){return e[t._config.category]});var o=e.min(t._data,function(e){return.9*(t._scales.x(e.x1)-t._scales.x(e.x0))}),a=e.max(t._xLabels.nodes(),function(t){return t.getComputedTextLength()});t._xLabels.each(function(r,s,c){var l=this;if(a<2*o)e.select(this).call(t.utils.wrap,o,n);else{e.select(this).attr("text-anchor","end").attr("dy",0).attr("transform","translate(3,-8)rotate(-90)");var f=.9*t._config.size.margin.bottom;this.getComputedTextLength()>f&&function(){e.select(l).on("mouseover",n.show).on("mouseout",n.hide);for(var i=1;l.getComputedTextLength()>f;)e.select(l).text(function(e){return(e[t._config.category]+"").slice(0,-i)+"..."}).attr("title",r),++i}()}var u=window.getComputedStyle(this,null).getPropertyValue("font-size"),g=Number(u.replace(/\D/g,""));if(0!==s&&s!==t._data.length-1){var d=i[s]-i[s-1],_=i[s+1]-i[s],p=r.value<t._data[s-1].value,x=r.value<t._data[s+1].value;(d<g-2||_<g-2)&&(p||x)&&e.select(this).remove()}}),t.chart.svg().selectAll(".bar").data(t._data).enter().append("rect").attr("class","bar").attr("id",function(e,n){var i="spineplot-"+n;return t._config.id&&(i="spineplot-"+e[t._config.id]),i}).attr("x",function(e){return t._scales.x(e.x0)}).attr("y",0).attr("width",function(e){return t._scales.x(e[t._config.value])}).attr("height",t.chart.height?t.chart.height:100).attr("fill",function(e){return!1!==t._scales.color?t._scales.color(e[t._config.fill]):t._getQuantileColor(e[t._config.fill],"default")}).attr("stroke","white").attr("stroke-width",1).style("opacity",.9).on("mouseover",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"onHover")}),t._tip.show(n,e.select(this).node()),t._config.hasOwnProperty("onmouseover")&&t._config.onmouseover.call(this,n,i)}).on("mouseout",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"default")}),t._tip.hide(),t._config.hasOwnProperty("onmouseout")&&t._config.onmouseout.call(this,n,i)}).on("click",function(e,n){t._config.hasOwnProperty("click")&&t._config.onclick.call(this,e,n)})}return t},o._drawStackByXAxis=function(){var t=this;t._tip.html(t._config.tip||function(e){var n="";return n+="<span>"+e.key+"</span>",e.key!==e[0].data[t._config.category]?(n+="<br><span>Y: "+t.utils.format(t._config.yAxis)(e[0].data[e.key])+"</span>",n+="<br><span>"+e[0].data[t._config.category]+"</span>",n+="<br><span>X: "+t.utils.format(t._config.xAxis)(e[0].data[t._config.value])+"</span>"):n+="<br><span>"+t.utils.format()(e[0].data[e.key])+"</span>",n}),t.chart.svg().call(t._tip);var n=t.utils.d3.tip().attr("class","title-tip").html(function(e){return e[t._config.category]});t.chart.svg().call(n),t._xLabels=t.chart.svg().append("g").attr("class","x axis").attr("transform","translate(0,"+(t.chart.height+20)+")").selectAll("g").data(t._data).enter().append("g").attr("class","tick").attr("transform",function(e){return"translate("+(t._scales.x(e.x0)+t._scales.x(e.x1-e.x0)/2)+", 0)"}).append("text").attr("text-anchor","middle").text(function(e){return e[t._config.category]});var i=e.min(t._data,function(e){return.9*(t._scales.x(e.x1)-t._scales.x(e.x0))}),a=e.max(t._xLabels.nodes(),function(t){return t.getComputedTextLength()});t._xLabels.each(function(o){var r=this;if(a<2*i)e.select(this).call(t.utils.wrap,i,n);else{e.select(this).attr("text-anchor","end").attr("dy",0).attr("transform","translate(3,-8)rotate(-90)");var s=.9*t._config.size.margin.bottom;this.getComputedTextLength()>s&&function(){e.select(r).on("mouseover",n.show).on("mouseout",n.hide);for(var i=1;r.getComputedTextLength()>s;)e.select(r).text(function(e){return(e[t._config.category]+"").slice(0,-i)+"..."}).attr("title",o),++i}()}}),t.chart.svg().append("g").selectAll("g").data(t._data).enter().append("g").attr("class","division").selectAll("rect").data(function(t){return t.stackValues}).enter().append("rect").attr("y",function(e){return e[0][1]?t._scales.y(e[0][1]/e[0].data.totalCollapse):t._scales.y(0)}).attr("x",function(e){return t._scales.x(e[0].data.x0)}).attr("width",function(e){return t._scales.x(e[0].data[t._config.value])}).attr("height",function(e){return t._scales.y(e[0][0]/e[0].data.totalCollapse)-t._scales.y(e[0][1]/e[0].data.totalCollapse)}).attr("stroke","white").attr("stroke-width",1).attr("fill",function(e){return t._scales.color(e[t._config.fill])}).on("mouseover",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"onHover")}),t._tip.show(n,e.select(this).node()),t._config.hasOwnProperty("onmouseover")&&t._config.onmouseover.call(this,n,i)}).on("mouseout",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"default")}),t._tip.hide(),t._config.hasOwnProperty("onmouseout")&&t._config.onmouseout.call(this,n,i)}).on("click",function(e,n){t._config.hasOwnProperty("click")&&t._config.onclick.call(this,e,n)}),o.drawLabels()},o._drawStackByYAxis=function(){var t=this;t._tip.html(t._config.tip||function(e){var n="<div><span>"+e[t._config.category]+"<span><br>";for(var i in e.data)e[1]-e[0]==e.data[i]&&(n+="<span>"+i+"</span>");return n+="<br>"+t.utils.format()(e[1]-e[0])}),t.chart.svg().call(t._tip),t.chart.svg().append("g").selectAll("g").data(t._data).enter().append("g").attr("class","division").attr("fill",function(e){return t._scales.color(e.key)}).selectAll("rect").data(function(t){return t}).enter().append("rect").attr("y",function(e){return t._scales.y(e.data[t._config.value])}).attr("x",function(e){return t._scales.x(e[0])}).attr("height",t._scales.y.bandwidth()).attr("width",function(e){return t._scales.x(e[1])-t._scales.x(e[0])}).on("mouseover",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"onHover")}),t._tip.show(n,e.select(this).node()),t._config.hasOwnProperty("onmouseover")&&t._config.onmouseover.call(this,n,i)}).on("mouseout",function(n,i){t._config.hasOwnProperty("quantiles")&&t._config.quantiles.hasOwnProperty("colorsOnHover")&&e.select(this).attr("fill",function(e){return t._getQuantileColor(e[t._config.fill],"default")}),t._tip.hide(),t._config.hasOwnProperty("onmouseout")&&t._config.onmouseout.call(this,n,i)}).on("click",function(e,n){t._config.hasOwnProperty("click")&&t._config.onclick.call(this,e,n)})},o._setQuantile=function(t){var i=this,o=[],a=[];if(i._config.quantiles&&i._config.quantiles.predefinedQuantiles&&i._config.quantiles.predefinedQuantiles.length>0)return i._config.quantiles.predefinedQuantiles;if(t.forEach(function(t){o.push(+t[i._config.fill])}),o.sort(i.utils.sortAscending),i._config&&i._config.quantiles&&i._config.quantiles.buckets)if(!0===i._config.quantiles.ignoreZeros){var r=n.dropWhile(o,function(t){return t<=0});a.push(o[0]),a.push(0);for(var s=1;s<=i._config.quantiles.buckets-1;s++)a.push(e.quantile(r,1*s/(i._config.quantiles.buckets-1)))}else{a.push(e.quantile(o,0));for(var c=1;c<=i._config.quantiles.buckets;c++)a.push(e.quantile(o,1*c/i._config.quantiles.buckets))}else a=[e.quantile(o,0),e.quantile(o,.2),e.quantile(o,.4),e.quantile(o,.6),e.quantile(o,.8),e.quantile(o,1)];return i._config.quantiles&&i._config.quantiles.buckets&&5===i._config.quantiles.buckets&&a[1]===a[2]&&a[2]===a[3]&&a[3]===a[4]&&a[4]===a[5]&&(a=[e.quantile(o,0),e.quantile(o,.2)]),a},o._getQuantileColor=function(t,e){var n=this,i=parseFloat(t);if(n._config&&n._config.bars.quantiles&&n._config.bars.quantiles.colors&&n._quantiles.length>2){if(n._config&&void 0!==n._config.bars.min&&void 0!==n._config.bars.max){if(i<n._config.bars.min||i>n._config.bars.max)return n._config.bars.quantiles.outOfRangeColor}else if(i<n._minMax[0]||i>n._minMax[1])return n._config.bars.quantiles.outOfRangeColor;if("default"==e){if(i<=n._quantiles[1])return n._config.bars.quantiles.colors[0];if(i<=n._quantiles[2])return n._config.bars.quantiles.colors[1];if(i<=n._quantiles[3])return n._config.bars.quantiles.colors[2];if(i<=n._quantiles[4])return n._config.quantiles.colors[3];if(i<=n._quantiles[5])return n._config.quantiles.colors[4]}if("onHover"==e&&n._config.hasOwnProperty("quantiles")&&n._config.quantiles.hasOwnProperty("colorsOnHover")){if(i<=n._quantiles[1])return n._config.quantiles.colorsOnHover[0];if(i<=n._quantiles[2])return n._config.quantiles.colorsOnHover[1];if(i<=n._quantiles[3])return n._config.quantiles.colorsOnHover[2];if(i<=n._quantiles[4])return n._config.quantiles.colorsOnHover[3];if(i<=n._quantiles[5])return n._config.quantiles.colorsOnHover[4]}}if(2==n._quantiles.length&&i<=n._quantiles[1])return n._config.quantiles.colors[0]},o.init(t),o}function p(t,n){var i=Object.create(n);return i.init=function(t){var n=this;n._config=t||{},n._data=[],n._scales={},n._axes={},n._config.parseDate=e.timeParse("%Y-%m-%d"),n._config.curve=e.curveLinear,n._tip=n.utils.d3.tip().attr("class","d3-tip "+(n._config.tooltip&&n._config.tooltip.classed?n._config.tooltip.classed:"")).html(n._config.tip&&n._config.tip.html?n._config.tip.html:function(t){var e=!1!==n._scales.color?n._scales.color(t.name):n._getQuantileColor(t.name,"default");if(n.chart.config.styles){var i="<div style='\n            line-height: 1; \n            opacity: "+n.chart.style.tooltip.opacity+"; \n            font-weight: "+n.chart.style.tooltip.text.fontWeight+"; \n            font-size: "+n.chart.style.tooltip.text.fontSize+"; \n            color: "+n.chart.style.tooltip.text.textColor+";\n            font-family: "+n.chart.style.tooltip.text.fontFamily+";\n            background-color: "+n.chart.style.tooltip.backgroundColor+"; \n            padding: "+n.chart.style.tooltip.text.padding+";   \n            border: "+n.chart.style.tooltip.border.width+" solid "+n.chart.style.tooltip.border.color+";  \n            border-radius:  "+n.chart.style.tooltip.border.radius+";'>";i+="<strong style='color:"+n.chart.style.tooltip.text.fontColor+";'>"}else var i="<div> <strong>";return i+="<strong style='color:"+e+"'>"+t.name+": </strong>",i+=t.y?"<span >"+(Number.isNaN(+t.y)?t.y:n.utils.format(n._config.yAxis)(t.y))+"</span>":"",i+="</div>"})},i.x=function(t){var e=this;return e._config.x=t,e},i.parseDate=function(t){var n=this;return n._config.parseDate=e.timeParse(t),n},i.y=function(t){var e=this;return e._config.y=t,e},i.series=function(t){var e=this;return e._config.series=t,e},i.curve=function(t){var e=this;return e._config.curve=t,e},i.fill=function(t){var e=this;return e._config.fill=t,e},i.colors=function(t){var e=this;return Array.isArray(t)?e._config.colors=t:e._scales.color=t,e},i.tip=function(t){var e=this;return e._config.tip=t,e._tip.html(e._config.tip),e},i.data=function(t){var n=this;return n._data=[],t.forEach(function(t){var e=Object.assign({},t);if(t[n._config.x])try{t[n._config.x].getTime(),Number.isNaN(t[n._config.x].getTime())||(e.x=t[n._config.x])}catch(i){e.x=n._config.parseDate(t[n._config.x])}e.color=t[n._config.fill],delete e[n._config.x],n._data.push(e)}),n._data=n._data.sort(function(t,n){return e.ascending(t.x,n.x)}),n._lines=n._config.y?n._config.y:n._config.series,n._lines=n._lines.map(function(t){return{name:t,values:n._data.map(function(e){return{x:e.x,y:+e[t]}})}}),n._lines.forEach(function(t){t.values=t.values.filter(function(t){return!isNaN(t.y)})}),n._line=e.line().curve(n._config.curve).defined(function(t){return void 0!==t.y}).x(function(t){return n._scales.x(t.x)}).y(function(t){return n._scales.y(t.y)}),n._area=e.area().curve(n._config.curve).x(function(t){return t.alreadyScaled&&!0===t.alreadyScaled?t.x:n._scales.x(t.x)}).y1(function(t){return t.alreadyScaled&&!0===t.alreadyScaled?t.y:n._scales.y(t.y)}),n},i.scales=function(){var n=this;if(n._xMinMax=e.extent(n._data,function(t){return t.x}),n._yMinMax=[n._config.yAxis.minZero?0:e.min(n._lines,function(t){return e.min(t.values,function(t){return t.y})}),e.max(n._lines,function(t){return e.max(t.values,function(t){return t.y})})],t={column:n._config.x,type:n._config.xAxis.scale,range:[0,n.chart.width],minZero:!1},n._scales.x=n.utils.generateScale(n._data,t),t={column:n._config.y,type:n._config.yAxis.scale,range:[n.chart.height,0],minZero:n._config.yAxis.minZero},n._scales.y=n.utils.generateScale(n._data,t),n._scales.x.domain(n._xMinMax),n._scales.y.domain(n._yMinMax).nice(),n._config.hasOwnProperty("colors")?n._scales.color=e.scaleOrdinal(n._config.colors):n._scales.color=e.scaleOrdinal(e.schemeCategory10),n._scales.x.domain()[0].getTime()==n._scales.x.domain()[1].getTime()){var i=n._scales.x.domain(),o=n._scales.x.range();n._scales.x.domain([new Date(i[0].getTime()-1),i[0],i[1]]).range([0,o[0]+(o[1]-o[0])/2,o[1]])}return n},i.drawLabels=function(){var t=this,n=t.chart.width;t.chart.svg().selectAll(".dots").each(function(i){var o=this;i.values.forEach(function(i,a){e.select(o).append("text").attr("class","dbox-label").attr("text-anchor","start").attr("transform",function(i){return t._scales.x(i.values[a].x)>=n?(e.select(this).attr("text-anchor","end"),"translate ("+(t._scales.x(i.values[a].x)-10)+","+(t._scales.y(i.values[a].y)+4)+")"):(e.select(this).attr("text-anchor","start"),"translate ("+(t._scales.x(i.values[a].x)+10)+","+(t._scales.y(i.values[a].y)+4)+")")}).text(function(){return i.y?t.utils.format(t._config.yAxis,!0)(i.y):""})})})},i.draw=function(){var t=this;t.chart.svg().call(t._tip),3===t._scales.x.domain().length&&t.chart.svg().select(".x.axis .tick").remove();t.chart.svg().selectAll(".lines").data(t._lines).enter().append("g").attr("class","lines"),t.chart.svg().selectAll(".lines").append("path").attr("class","line").attr("d",function(e){return t._line(e.values)}).attr("stroke",function(e){return!1!==t._scales.color?t._scales.color(e.name):t._getQuantileColor(e.name,"default")}).attr("stroke-width",4).attr("fill","none"),t.chart.svg().selectAll(".dots").data(t._lines).enter().append("g").attr("class","dots").selectAll(".circle").data(function(t){return t.values.forEach(function(e){e.name=t.name}),t.values}).enter().append("circle").attr("class","dot").attr("cx",function(e,n){return t._scales.x(e.x)}).attr("cy",function(e){return t._scales.y(e.y)}).attr("r",4).style("stroke",function(e){return!1!==t._scales.color?t._scales.color(e.name):t._getQuantileColor(e.name,"default")}).style("stroke-width",2).style("fill","#fff").style("fill-opacity",.5).on("mouseover",function(n,i){t._config.mouseover,t._tip.show(n,e.select(this).node())}).on("mouseout",function(n,i){t._config.mouseout,t._tip.hide(n,e.select(this).node())});return i.drawLabels(),t},i.init(t),i}function x(t,n){function i(t,e,n){n(null,t.key(function(t){return t[e]}))}var o=Object.create(n);return o.init=function(t){var n=this;n._config=t||{},n._config._padding=3,n._config._labels=!1,n._config.tip=function(t){var e="<div>";return t.parent.data.name&&"data"!==t.parent.data.name&&(e+="<span>"+t.parent.data.name+"</span><br>"),e+="<span>"+t.data.name+"</span><br>",e+="<span>"+n.utils.format()(t.value)+"</span>",e+="</div>"},n._data=[],n._scales={color:e.scaleOrdinal(e.schemeCategory20c)},n._axes={},n._tip=n.utils.d3.tip().attr("class","d3-tip tip-treemap").direction("n").html(n._config.tip)},o.size=function(t){var e=this;return e._config._size=t,e},o.colors=function(t,n){var i=this;return i._scales.color=e.scaleOrdinal(t),n&&i._scales.color.domain(n),i},o.padding=function(t){var e=this;return e._config._padding=t,e},o.nestBy=function(t){var e=this;if(Array.isArray(t)){if(0==t.length)throw"Error: nestBy() array is empty";e._config._keys=t}else if("string"==typeof t||t instanceof String)e._config._keys=[t];else{if(void 0==t||null==t)throw"Error: nestBy() expects column names to deaggregate data";e._config._keys=[t.toString()],console.warning("nestBy() expected name of columns. Argument will be forced to string version .toString()")}return e._config._labelName=e._config._keys[e._config._keys.length-1],e},o.format=function(t){var n=this;return"function"==typeof t||t instanceof Function?n.utils.format=t:n.utils.format=e.format(t,n._config.decimals),n},o.labels=function(t){var e=this;return e._config._labels=Boolean(t),e},o.tip=function(t){var e=this;return e._config.tip=t,e._tip.html(e._config.tip),e},o.scales=function(t){return this},o.axes=function(){return this},o.domains=function(){return this},o.isValidStructure=function(t){var e=this;if(("string"==typeof t.name||t.name instanceof String)&&Array.isArray(t.children)){var n=!0;return t.children.forEach(function(t){n=n&&e.isValidStructure(t)}),n}return("string"==typeof t.name||t.name instanceof String)&&Number(t[e._config._size])==t[e._config._size]},o.formatNestedData=function(t){var e=this;if(t.key?(t.name=t.key,delete t.key):Array.isArray(t.values)||(t.name=t[e._config._labelName]),Array.isArray(t.values)){var n=[];t.values.forEach(function(t){n.push(e.formatNestedData(t))}),t.children=n,delete t.values}return!t[e._config._size]&&t.value&&(t[e._config._size]=t.value),t},o.data=function(t){var n=this;if(t)if(Array.isArray(t)&&t.length>0){if(!n.isValidStructure(t[0])){t.forEach(function(t){t[n._config._size]=+t[n._config._size]});try{if(!n._config._keys)throw"nestBy() in layer was not configured";for(var o=e.nest(),a=e.queue(),r=0;r<n._config._keys.length;r++)a.defer(i,o,n._config._keys[r]);a.awaitAll(function(i,o){var a=o[0].rollup(function(t){return e.sum(t,function(t){return t[n._config._size]})}).entries(t),r={};r.key="data",r.values=_.cloneDeep(a),t=n.formatNestedData(r),n._data=t})}catch(t){console.error(t)}}}else if(!n.isValidStructure(t))try{if(!t.key)throw"Property 'key' not found";if(t[n._config._size]!==Number(t[n._config._size]))throw"Value used for treemap rect size is not a number";t=n.formatNestedData(t),n._data=t}catch(t){console.error(t)}return n},o.draw=function(){var t=this;t.chart.svg().call(t._tip);var n=e.treemap().tile(e.treemapResquarify).size([t.chart.width,t.chart.height]).round(!0).paddingInner(t._config._padding),i=e.hierarchy(t._data).eachBefore(function(t){t.data.id=(t.parent?t.parent.data.id+".":"")+t.data.name}).sum(function(e){return e[t._config._size]}).sort(function(t,e){return e.height-t.height||e.value-t.value});n(i);var o=t.chart.svg().selectAll("g").data(i.leaves()).enter().append("g").attr("transform",function(t){return"translate("+t.x0+","+t.y0+")"}),a=o.append("rect").attr("id",function(t){return t.data.id}).attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}).attr("fill",function(e){return t._scales.color(e.data.name)});if(o.append("clipPath").attr("id",function(t){return"clip-"+t.data.id}).append("use").attr("xlink:href",function(t){return"#"+t.data.id}),t._config._labels){var r=o.append("text").attr("clip-path",function(t){return"url(#clip-"+t.data.id+")"});r.append("tspan").attr("class","capitalize").attr("x",8).attr("y",25).text(function(t){if(t.value>2){var e=t.data.id.replace("data.","").split(".");return e.length>1?e.slice(e.length-2,e.length).join(" / "):e[e.length-1].toString()}return""}),r.append("tspan").attr("class","capitalize").attr("x",8).attr("y",45).text(function(e){return e.value>2?t.utils.format(null,!0)(e.value):""})}return a.on("mouseover",function(n){t._tip.show(n,e.select(this).node())}).on("mouseout",function(n){t._tip.hide(n,e.select(this).node())}),t},o.init(t),o}var h=require("d3-tip"),y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.chart=o,t.bars=a,t.distro=s,t.heatmap=c,t.leaflet=l,t.map=f,t.radar=u,t.scatter=g,t.spineplot=d,t.timeline=p,t.treemap=x,Object.defineProperty(t,"__esModule",{value:!0})});